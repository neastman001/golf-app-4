<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Golf Betting App</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --forest: #1a4d2e;
            --grass: #4f772d;
            --fairway: #90be6d;
            --sand: #f4a259;
            --sky: #f8f9fa;
            --white: #ffffff;
            --shadow: rgba(26, 77, 46, 0.1);
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background: linear-gradient(135deg, var(--sky) 0%, #e8f5e9 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--forest);
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--forest);
            text-align: center;
            margin-bottom: 10px;
            text-shadow: 2px 2px 0 var(--fairway);
        }

        .subtitle {
            text-align: center;
            color: var(--grass);
            font-size: 0.9rem;
            margin-bottom: 30px;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .screen {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: var(--white);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px var(--shadow);
            margin-bottom: 20px;
        }

        .mode-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .mode-btn {
            padding: 30px 20px;
            background: linear-gradient(135deg, var(--fairway) 0%, var(--grass) 100%);
            color: var(--white);
            border: 3px solid transparent;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .mode-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(79, 119, 45, 0.3);
        }

        .mode-btn .icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .mode-btn .title {
            font-family: 'Playfair Display', serif;
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .mode-btn .desc {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .option-tabs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            padding: 12px;
            background: var(--sky);
            border: 2px solid var(--fairway);
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            text-align: center;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, var(--grass) 0%, var(--forest) 100%);
            color: var(--white);
            border-color: var(--forest);
        }

        .player-count-selector {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .player-count-btn {
            padding: 15px 25px;
            background: var(--sky);
            border: 2px solid var(--fairway);
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .player-count-btn.selected {
            background: linear-gradient(135deg, var(--grass) 0%, var(--forest) 100%);
            color: var(--white);
            border-color: var(--forest);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--forest);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--fairway);
            border-radius: 10px;
            font-size: 1rem;
            font-family: 'DM Sans', sans-serif;
            transition: all 0.3s;
        }

        textarea {
            resize: vertical;
            min-height: 60px;
            font-family: monospace;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--grass);
            box-shadow: 0 0 0 3px rgba(79, 119, 45, 0.1);
        }

        .two-col {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 10px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: var(--sky);
            border-radius: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            cursor: pointer;
        }

        .checkbox-group label {
            margin: 0;
            font-size: 0.9rem;
            text-transform: none;
            cursor: pointer;
        }

        .upload-area {
            border: 3px dashed var(--fairway);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: var(--sky);
        }

        .upload-area:hover {
            border-color: var(--grass);
            background: #e8f5e9;
        }

        .upload-area.dragover {
            border-color: var(--grass);
            background: #e8f5e9;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        #scorecardPreview {
            max-width: 100%;
            border-radius: 10px;
            margin-top: 15px;
        }

        .team-section {
            background: linear-gradient(135deg, var(--fairway) 0%, var(--grass) 100%);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            color: var(--white);
        }

        .team-section h3 {
            font-family: 'Playfair Display', serif;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--grass) 0%, var(--forest) 100%);
            color: var(--white);
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(79, 119, 45, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(79, 119, 45, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-back {
            background: linear-gradient(135deg, var(--sand) 0%, #e76f51 100%);
            margin-top: 10px;
        }

        .scorecard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--forest) 0%, var(--grass) 100%);
            padding: 20px;
            border-radius: 15px;
            color: var(--white);
        }

        .hole-nav button {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid var(--white);
            color: var(--white);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .hole-nav button:hover:not(:disabled) {
            background: var(--white);
            color: var(--forest);
        }

        .hole-nav button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .hole-info {
            text-align: center;
        }

        .hole-info h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
        }

        .hole-info .handicap {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-top: 5px;
        }

        .score-inputs {
            display: grid;
            gap: 12px;
        }

        .player-score {
            background: var(--sky);
            padding: 12px 15px;
            border-radius: 10px;
        }

        .player-score label {
            font-size: 0.85rem;
            margin-bottom: 8px;
            font-weight: 600;
            display: block;
        }

        .score-input-row {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
        }

        .score-input-row input {
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            padding: 10px;
            width: 60px;
            border: 2px solid var(--fairway);
            border-radius: 8px;
        }

        .score-input-row input:focus {
            outline: none;
            border-color: var(--grass);
        }

        .net-box {
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            padding: 10px;
            width: 60px;
            background: var(--white);
            border: 2px solid var(--grass);
            border-radius: 8px;
            color: var(--forest);
        }
        
        .stroke-indicator {
            color: var(--sand);
            font-size: 1.2rem;
            font-weight: 700;
            width: 15px;
            text-align: left;
        }

        .score-labels {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 5px;
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--grass);
            font-weight: 600;
        }

        .score-labels span {
            width: 60px;
            text-align: center;
        }

        .standings {
            background: linear-gradient(135deg, var(--fairway) 0%, var(--grass) 100%);
            padding: 20px;
            border-radius: 15px;
            color: var(--white);
            margin-top: 20px;
        }

        .standings h3 {
            font-family: 'Playfair Display', serif;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.5rem;
        }

        .standing-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .standing-item:last-child {
            border-bottom: none;
        }

        .carryover {
            background: var(--sand);
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            margin-top: 12px;
            font-weight: 700;
        }

        .results-card {
            background: linear-gradient(135deg, var(--forest) 0%, var(--grass) 100%);
            color: var(--white);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 20px;
        }

        .results-card h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            margin-bottom: 20px;
            text-align: center;
        }

        .result-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
        }

        .result-section h3 {
            font-family: 'Playfair Display', serif;
            margin-bottom: 10px;
            font-size: 1.3rem;
        }

        .winner {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .money {
            color: var(--sand);
            font-size: 1.5rem;
            font-weight: 900;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: var(--grass);
        }

        .spinner {
            border: 3px solid var(--sky);
            border-top: 3px solid var(--grass);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        .help-text {
            font-size: 0.85rem;
            color: var(--grass);
            margin-top: 5px;
            font-style: italic;
        }
        
        .scorecard-table th,
        .scorecard-table td {
            border: 1px solid var(--fairway);
            padding: 8px 6px;
            text-align: center;
        }
        
        .scorecard-table th {
            background: linear-gradient(135deg, var(--grass) 0%, var(--forest) 100%);
            color: white;
            font-weight: 700;
        }
        
        .scorecard-table .hole-header {
            background: var(--fairway);
            color: var(--forest);
            font-weight: 600;
        }
        
        .scorecard-table .player-row {
            background: var(--sky);
        }
        
        .scorecard-table .total-col {
            background: var(--fairway);
            font-weight: 700;
            color: var(--forest);
        }
        
        .scorecard-table .stroke-hole {
            color: var(--sand);
            font-weight: 700;
        }
        
        .custom-dropdown {
            position: relative;
            width: 100%;
        }
        
        .custom-dropdown-selected {
            width: 100%;
            padding: 12px;
            background: white;
            border: 2px solid var(--fairway);
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1rem;
        }
        
        .custom-dropdown-selected:hover {
            border-color: var(--grass);
        }
        
        .custom-dropdown-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid var(--fairway);
            border-radius: 12px;
            margin-top: 5px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .custom-dropdown-list.show {
            display: block;
        }
        
        .custom-dropdown-item {
            padding: 10px 12px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--sky);
        }
        
        .custom-dropdown-item:hover {
            background: var(--sky);
        }
        
        .custom-dropdown-item:last-child {
            border-bottom: none;
        }
        
        .delete-icon {
            color: #e74c3c;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 5px;
            margin-left: 10px;
        }
        
        .delete-icon:hover {
            color: #c0392b;
            transform: scale(1.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚õ≥ GolfBet</h1>
        <p class="subtitle">Ponte Vedra Golf Betting</p>

        <!-- Mode Selection Screen -->
        <div id="modeScreen" class="screen active">
            <div class="card">
                <h2 style="font-family: 'Playfair Display', serif; margin-bottom: 25px; text-align: center;">Choose Game Mode</h2>
                
                <div class="mode-selection">
                    <div class="mode-btn" onclick="selectMode('skins')">
                        <div class="icon">üèåÔ∏è</div>
                        <div class="title">Skins</div>
                        <div class="desc">2-4 Players</div>
                    </div>
                    <div class="mode-btn" onclick="selectMode('team')">
                        <div class="icon">üë•</div>
                        <div class="title">Team Best Ball</div>
                        <div class="desc">2v2 Teams</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Course Data Entry Screen -->
        <div id="courseDataScreen" class="screen">
            <div class="card">
                <h2 style="font-family: 'Playfair Display', serif; margin-bottom: 20px;">Course Information</h2>
                
                <div class="form-group">
                    <label>Saved Courses</label>
                    <div class="custom-dropdown" id="courseDropdown">
                        <div class="custom-dropdown-selected" onclick="toggleCourseDropdown()">
                            <span id="selectedCourseText">-- Select Saved Course --</span>
                            <span>‚ñº</span>
                        </div>
                        <div class="custom-dropdown-list" id="courseDropdownList">
                            <!-- Dynamic course list will be inserted here -->
                        </div>
                    </div>
                </div>
                
                <div style="text-align: center; margin: 20px 0; color: var(--grass); font-weight: 600;">
                    - OR -
                </div>

                <!-- Upload Option -->
                <div id="uploadOption">
                    <div class="upload-area" id="uploadArea" onclick="document.getElementById('scorecardInput').click()">
                        <div class="upload-icon">üì∏</div>
                        <p style="font-weight: 600; margin-bottom: 5px;">Take or Upload Scorecard Photo</p>
                        <p style="font-size: 0.85rem; opacity: 0.7;">We'll read par and handicap/stroke index</p>
                        <input type="file" id="scorecardInput" accept="image/*" capture="environment" style="display: none;" onchange="handleScorecardUpload(event)">
                        <img id="scorecardPreview" style="display: none;">
                    </div>

                    <div id="loadingArea" class="loading" style="display: none;">
                        <div class="spinner"></div>
                        <p>Reading scorecard...</p>
                    </div>
                    
                    <button class="btn" onclick="saveCourse()" style="margin-top: 15px; background: linear-gradient(135deg, var(--sand) 0%, #e76f51 100%); display: none;" id="uploadSaveCourseBtn">üíæ Save This Course</button>
                </div>
                
                <div style="text-align: center; margin: 20px 0; color: var(--grass); font-weight: 600;">
                    - OR -
                </div>

                <!-- Manual Entry Option -->
                <div id="manualOption">
                    <div class="form-group">
                        <label>Course Name</label>
                        <input type="text" id="manualCourseName" placeholder="e.g., Ocean Course">
                        <p class="help-text">Enter the name of the golf course</p>
                    </div>

                    <div class="form-group">
                        <label>Tee Selection</label>
                        <input type="text" id="manualTeeName" placeholder="e.g., Blue Tees">
                        <p class="help-text">Enter the tee color or name</p>
                    </div>

                    <div class="form-group">
                        <label>Pars (18 holes)</label>
                        <textarea id="manualPars" placeholder="4,5,3,4,4,3,5,4,4,4,3,5,4,4,3,4,5,4"></textarea>
                        <p class="help-text">Enter 18 numbers separated by commas</p>
                    </div>

                    <div class="form-group">
                        <label>Handicap/Stroke Index (1-18)</label>
                        <textarea id="manualHandicaps" placeholder="1,3,15,5,11,17,7,9,13,2,16,4,6,12,18,8,10,14"></textarea>
                        <p class="help-text">Enter 18 numbers (1-18) separated by commas</p>
                    </div>

                    <div class="form-group">
                        <label>Course Rating & Slope (Optional)</label>
                        <div class="two-col">
                            <input type="number" id="courseRating" placeholder="Course Rating (e.g., 72.5)" step="0.1">
                            <input type="number" id="courseSlope" placeholder="Slope (e.g., 130)" step="1">
                        </div>
                        <p class="help-text">Used for calculating course handicap from index (optional)</p>
                    </div>

                    <button class="btn" onclick="saveManualCourseData()">Continue</button>
                </div>

                <button class="btn btn-back" onclick="showScreen('modeScreen')" style="margin-top: 20px;">Back</button>
            </div>
        </div>

        <!-- Skins Setup Screen -->
        <div id="skinsSetupScreen" class="screen">
            <div class="card">
                <h2 style="font-family: 'Playfair Display', serif; margin-bottom: 20px;">Skins Game Setup</h2>
                
                <div class="form-group">
                    <label>Number of Players</label>
                    <div class="player-count-selector">
                        <div class="player-count-btn" onclick="selectPlayerCount(2)">2</div>
                        <div class="player-count-btn selected" onclick="selectPlayerCount(3)">3</div>
                        <div class="player-count-btn" onclick="selectPlayerCount(4)">4</div>
                    </div>
                </div>

                <div class="form-group">
                    <label>$ Per Skin</label>
                    <input type="number" id="skinValue" value="5" min="1">
                </div>

                <div class="form-group checkbox-group">
                    <input type="checkbox" id="skinsBirdieMultiplier">
                    <label for="skinsBirdieMultiplier">Birdie 2x, Eagle 4x (includes carryovers)</label>
                </div>

                <div id="skinsPlayerInputs">
                    <div class="form-group" id="skinsP1Group">
                        <label>Player 1</label>
                        <select id="skinsP1Select" onchange="loadPlayer('skinsP1Select', 'skinsPlayer1', 'skinsHcp1')" style="margin-bottom: 10px;">
                            <option value="">-- Select Player --</option>
                        </select>
                        <div class="two-col">
                            <input type="text" id="skinsPlayer1" placeholder="Name" onchange="refreshPlayerDropdowns()">
                            <input type="number" id="skinsHcp1" placeholder="Index" min="0" max="54" step="0.1">
                        </div>
                    </div>

                    <div class="form-group" id="skinsP2Group">
                        <label>Player 2</label>
                        <select id="skinsP2Select" onchange="loadPlayer('skinsP2Select', 'skinsPlayer2', 'skinsHcp2')" style="margin-bottom: 10px;">
                            <option value="">-- Select Player --</option>
                        </select>
                        <div class="two-col">
                            <input type="text" id="skinsPlayer2" placeholder="Name" onchange="refreshPlayerDropdowns()">
                            <input type="number" id="skinsHcp2" placeholder="Index" min="0" max="54" step="0.1">
                        </div>
                    </div>

                    <div class="form-group" id="skinsP3Group">
                        <label>Player 3</label>
                        <select id="skinsP3Select" onchange="loadPlayer('skinsP3Select', 'skinsPlayer3', 'skinsHcp3')" style="margin-bottom: 10px;">
                            <option value="">-- Select Player --</option>
                        </select>
                        <div class="two-col">
                            <input type="text" id="skinsPlayer3" placeholder="Name" onchange="refreshPlayerDropdowns()">
                            <input type="number" id="skinsHcp3" placeholder="Index" min="0" max="54" step="0.1">
                        </div>
                    </div>

                    <div class="form-group hidden" id="skinsP4Group">
                        <label>Player 4</label>
                        <select id="skinsP4Select" onchange="loadPlayer('skinsP4Select', 'skinsPlayer4', 'skinsHcp4')" style="margin-bottom: 10px;">
                            <option value="">-- Select Player --</option>
                        </select>
                        <div class="two-col">
                            <input type="text" id="skinsPlayer4" placeholder="Name" onchange="refreshPlayerDropdowns()">
                            <input type="number" id="skinsHcp4" placeholder="Index" min="0" max="54" step="0.1">
                        </div>
                    </div>
                </div>

                <button class="btn" onclick="startSkins()">Start Game</button>
                <button class="btn btn-back" onclick="showScreen('courseDataScreen')">Back</button>
                <div style="text-align: center; margin-top: 15px;">
                    <a href="#" onclick="deletePlayerFromDropdown(); return false;" style="color: var(--sand); text-decoration: underline; font-size: 0.9rem;">üóëÔ∏è Delete a Saved Player</a>
                </div>
            </div>
        </div>

        <!-- Team Setup Screen -->
        <div id="teamSetupScreen" class="screen">
            <div class="card">
                <h2 style="font-family: 'Playfair Display', serif; margin-bottom: 20px;">Team Best Ball Setup</h2>
                
                <div class="form-group">
                    <label>Point Value ($)</label>
                    <input type="number" id="pointValue" value="5" min="1">
                </div>

                <div class="form-group checkbox-group">
                    <input type="checkbox" id="teamBirdieMultiplier">
                    <label for="teamBirdieMultiplier">Birdie 2x, Eagle 4x (includes carryovers)</label>
                </div>

                <div class="team-section">
                    <h3>üèåÔ∏è Team 1</h3>
                    <div class="form-group">
                        <label style="color: white; text-transform: none;">Player 1</label>
                        <select id="team1p1Select" onchange="loadPlayer('team1p1Select', 'team1p1', 'team1p1Hcp')" style="border-color: white; margin-bottom: 10px;">
                            <option value="">-- Select Player --</option>
                        </select>
                        <div class="two-col">
                            <input type="text" id="team1p1" placeholder="Name" style="border-color: white;" onchange="refreshPlayerDropdowns()">
                            <input type="number" id="team1p1Hcp" placeholder="Index" min="0" max="54" step="0.1" style="border-color: white;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label style="color: white; text-transform: none;">Player 2</label>
                        <select id="team1p2Select" onchange="loadPlayer('team1p2Select', 'team1p2', 'team1p2Hcp')" style="border-color: white; margin-bottom: 10px;">
                            <option value="">-- Select Player --</option>
                        </select>
                        <div class="two-col">
                            <input type="text" id="team1p2" placeholder="Name" style="border-color: white;" onchange="refreshPlayerDropdowns()">
                            <input type="number" id="team1p2Hcp" placeholder="Index" min="0" max="54" step="0.1" style="border-color: white;">
                        </div>
                    </div>
                </div>

                <div class="team-section">
                    <h3>üèåÔ∏è Team 2</h3>
                    <div class="form-group">
                        <label style="color: white; text-transform: none;">Player 1</label>
                        <select id="team2p1Select" onchange="loadPlayer('team2p1Select', 'team2p1', 'team2p1Hcp')" style="border-color: white; margin-bottom: 10px;">
                            <option value="">-- Select Player --</option>
                        </select>
                        <div class="two-col">
                            <input type="text" id="team2p1" placeholder="Name" style="border-color: white;" onchange="refreshPlayerDropdowns()">
                            <input type="number" id="team2p1Hcp" placeholder="Index" min="0" max="54" step="0.1" style="border-color: white;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label style="color: white; text-transform: none;">Player 2</label>
                        <select id="team2p2Select" onchange="loadPlayer('team2p2Select', 'team2p2', 'team2p2Hcp')" style="border-color: white; margin-bottom: 10px;">
                            <option value="">-- Select Player --</option>
                        </select>
                        <div class="two-col">
                            <input type="text" id="team2p2" placeholder="Name" style="border-color: white;" onchange="refreshPlayerDropdowns()">
                            <input type="number" id="team2p2Hcp" placeholder="Index" min="0" max="54" step="0.1" style="border-color: white;">
                        </div>
                    </div>
                </div>

                <button class="btn" onclick="startTeam()">Start Match</button>
                <button class="btn btn-back" onclick="showScreen('courseDataScreen')">Back</button>
                <div style="text-align: center; margin-top: 15px;">
                    <a href="#" onclick="deletePlayerFromDropdown(); return false;" style="color: var(--sand); text-decoration: underline; font-size: 0.9rem;">üóëÔ∏è Delete a Saved Player</a>
                </div>
            </div>
        </div>

        <!-- Skins Scorecard Screen -->
        <div id="skinsScorecardScreen" class="screen">
            <div class="card">
                <div class="scorecard-header">
                    <div class="hole-nav">
                        <button onclick="backToSetup()" style="background: var(--sand); border-color: var(--sand);">‚Üê Back</button>
                    </div>
                    <div class="hole-info">
                        <h2 id="skinsHoleNumber">Hole 1</h2>
                        <p id="skinsHolePar">Par 4</p>
                        <p class="handicap" id="skinsHoleHcp">Handicap 1</p>
                    </div>
                    <div class="hole-nav">
                        <!-- Previous button removed -->
                    </div>
                </div>

                <div class="score-inputs" id="skinsScoreInputs">
                    <!-- Dynamic player inputs will be inserted here -->
                </div>

                <div class="standings">
                    <h3>Skins Won</h3>
                    
                    <div class="form-group checkbox-group" style="margin-bottom: 15px;">
                        <input type="checkbox" id="skinsLiveMultiplier" onchange="toggleSkinsMultiplier()">
                        <label for="skinsLiveMultiplier" style="color: white;">Birdie 2x, Eagle 4x</label>
                    </div>
                    
                    <div id="skinsStandingsList">
                        <!-- Dynamic standings will be inserted here -->
                    </div>
                    <div id="skinsCarryover" class="carryover" style="display: none;">
                        Carryover: 0 skins
                    </div>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn" onclick="skinsNextHole()" id="skinsNextBtn" style="flex: 1;">Next ‚Üí</button>
                </div>
                <button class="btn" onclick="showSkinsScorecard()" style="margin-top: 10px; width: 100%; background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);">üìä See Scorecard</button>
                <button class="btn" onclick="finishSkinsGame()" style="margin-top: 10px; width: 100%; display: none;" id="skinsFinishBtn">Complete Round</button>
            </div>
        </div>

        <!-- Team Scorecard Screen -->
        <div id="teamScorecardScreen" class="screen">
            <div class="card">
                <div class="scorecard-header">
                    <div class="hole-nav">
                        <button onclick="backToSetup()" style="background: var(--sand); border-color: var(--sand);">‚Üê Back</button>
                    </div>
                    <div class="hole-info">
                        <h2 id="teamHoleNumber">Hole 1</h2>
                        <p id="teamHolePar">Par 4</p>
                        <p class="handicap" id="teamHoleHcp">Handicap 1</p>
                    </div>
                    <div class="hole-nav">
                        <button onclick="teamPrevHole()" id="teamPrevBtn">‚Üê Prev</button>
                        <button onclick="teamNextHole()" id="teamNextBtn">Next ‚Üí</button>
                    </div>
                </div>

                <div class="score-inputs">
                    <div class="player-score">
                        <label id="teamT1P1Label">Team 1 Player 1</label>
                        <div class="score-labels">
                            <span>Gross</span>
                            <span>Net</span>
                        </div>
                        <div class="score-input-row">
                            <input type="text" inputmode="numeric" pattern="[0-9]*" id="teamT1P1Score" onchange="handleTeamScoreInput()">
                            <div class="net-box" id="teamT1P1Net">-</div>
                        </div>
                    </div>
                    <div class="player-score">
                        <label id="teamT1P2Label">Team 1 Player 2</label>
                        <div class="score-labels">
                            <span>Gross</span>
                            <span>Net</span>
                        </div>
                        <div class="score-input-row">
                            <input type="text" inputmode="numeric" pattern="[0-9]*" id="teamT1P2Score" onchange="handleTeamScoreInput()">
                            <div class="net-box" id="teamT1P2Net">-</div>
                        </div>
                    </div>
                    <div class="player-score">
                        <label id="teamT2P1Label">Team 2 Player 1</label>
                        <div class="score-labels">
                            <span>Gross</span>
                            <span>Net</span>
                        </div>
                        <div class="score-input-row">
                            <input type="text" inputmode="numeric" pattern="[0-9]*" id="teamT2P1Score" onchange="handleTeamScoreInput()">
                            <div class="net-box" id="teamT2P1Net">-</div>
                        </div>
                    </div>
                    <div class="player-score">
                        <label id="teamT2P2Label">Team 2 Player 2</label>
                        <div class="score-labels">
                            <span>Gross</span>
                            <span>Net</span>
                        </div>
                        <div class="score-input-row">
                            <input type="text" inputmode="numeric" pattern="[0-9]*" id="teamT2P2Score" onchange="handleTeamScoreInput()">
                            <div class="net-box" id="teamT2P2Net">-</div>
                        </div>
                    </div>
                </div>

                <div class="standings">
                    <h3>Current Standings</h3>
                    
                    <div class="form-group checkbox-group" style="margin-bottom: 15px;">
                        <input type="checkbox" id="teamLiveMultiplier" onchange="toggleTeamMultiplier()">
                        <label for="teamLiveMultiplier" style="color: white;">Birdie 2x, Eagle 4x</label>
                    </div>
                    
                    <div class="standing-item">
                        <span>Skins</span>
                        <span id="teamSkinsStanding">Team 1: 0 | Team 2: 0</span>
                    </div>
                    <div class="standing-item">
                        <span>Nassau</span>
                        <span id="teamNassauStanding">Team 1: 0 | Team 2: 0</span>
                    </div>
                    <div class="standing-item">
                        <span>Scotch</span>
                        <span id="teamScotchStanding">Team 1: 0 | Team 2: 0</span>
                    </div>
                </div>

                <button class="btn" onclick="finishTeamMatch()" style="margin-top: 20px; display: none;" id="teamFinishBtn">Complete Round</button>
            </div>
        </div>

        <!-- Skins Full Scorecard View Screen -->
        <div id="skinsFullScorecardScreen" class="screen">
            <div class="card">
                <h2 style="font-family: 'Playfair Display', serif; margin-bottom: 20px; text-align: center;">üìä Full Scorecard</h2>
                
                <div style="overflow-x: auto;">
                    <table id="skinsFullScorecardTable" style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
                        <!-- Dynamic scorecard will be inserted here -->
                    </table>
                </div>
                
                <button class="btn" onclick="showScreen('skinsScorecardScreen')" style="margin-top: 20px;">‚Üê Back to Game</button>
            </div>
        </div>

        <!-- Skins Results Screen -->
        <div id="skinsResultsScreen" class="screen">
            <div class="results-card">
                <h2>üèÜ Skins Results</h2>
                
                <div class="result-section">
                    <div id="skinsResultsList"></div>
                </div>
            </div>

            <div class="card">
                <button class="btn" onclick="resetApp()">New Game</button>
            </div>
        </div>

        <!-- Team Results Screen -->
        <div id="teamResultsScreen" class="screen">
            <div class="results-card">
                <h2>üèÜ Match Results</h2>
                
                <div class="result-section">
                    <h3>Skins</h3>
                    <div class="winner" id="teamSkinsWinner"></div>
                    <div class="money" id="teamSkinsMoney"></div>
                </div>

                <div class="result-section">
                    <h3>Nassau</h3>
                    <div class="winner" id="teamNassauWinner"></div>
                    <div class="money" id="teamNassauMoney"></div>
                </div>

                <div class="result-section">
                    <h3>Scotch (6-Point)</h3>
                    <div class="winner" id="teamScotchWinner"></div>
                    <div class="money" id="teamScotchMoney"></div>
                </div>

                <div class="result-section">
                    <h3>Total</h3>
                    <div class="winner" id="teamTotalWinner"></div>
                    <div class="money" id="teamTotalMoney"></div>
                </div>
            </div>

            <div class="card">
                <button class="btn" onclick="resetApp()">New Game</button>
            </div>
        </div>
    </div>

    <script>
        console.log('=== GOLF APP SCRIPT LOADING - VERSION 2025-02-07-15:35 ===');
        console.log('If Skins button does nothing, hard refresh browser: Ctrl+Shift+R (Windows) or Cmd+Shift+R (Mac)');
        
        let pars = [4, 5, 3, 4, 4, 3, 5, 4, 4, 4, 3, 5, 4, 4, 3, 4, 5, 4];
        let handicapIndex = [1, 3, 15, 5, 11, 17, 7, 9, 13, 2, 16, 4, 6, 12, 18, 8, 10, 14];
        let courseRating = null;
        let courseSlope = null;
        let currentMode = '';
        let skinsPlayerCount = 3;
        let dataEntryMethod = 'upload';
        let savedCourses = [];
        let savedPlayers = [];
        
        // Load saved courses from localStorage
        function loadSavedCourses() {
            const saved = localStorage.getItem('golfCourses');
            if (saved) {
                savedCourses = JSON.parse(saved);
            }
        }
        
        // Load saved players from localStorage
        function loadSavedPlayers() {
            const saved = localStorage.getItem('golfPlayers');
            if (saved) {
                savedPlayers = JSON.parse(saved);
            }
        }
        
        function saveCourse() {
            console.log('=== SAVE COURSE FUNCTION CALLED ===');
            
            try {
                const courseName = window.prompt('Enter course name (e.g., "Ponte Vedra Inn & Club"):');
                console.log('Course name entered:', courseName);
                
                if (!courseName || courseName.trim() === '') {
                    console.log('User cancelled or entered empty course name');
                    return;
                }
                
                const teeName = window.prompt('Enter tee name (e.g., "Ocean - Blue Tees"):');
                console.log('Tee name entered:', teeName);
                
                if (!teeName || teeName.trim() === '') {
                    console.log('User cancelled or entered empty tee name');
                    return;
                }
                
                const course = {
                    name: courseName.trim(),
                    tees: teeName.trim(),
                    displayName: `${courseName.trim()} - ${teeName.trim()}`,
                    pars: [...pars],
                    handicapIndex: [...handicapIndex],
                    rating: courseRating,
                    slope: courseSlope
                };
                
                console.log('Course object created:', course);
                
                savedCourses.push(course);
                localStorage.setItem('golfCourses', JSON.stringify(savedCourses));
                
                window.alert(`Course "${course.displayName}" saved successfully!`);
                updateSavedCoursesDropdown();
                
                console.log('Course saved. Total courses:', savedCourses.length);
            } catch (error) {
                console.error('ERROR in saveCourse:', error);
                window.alert('Error saving course: ' + error.message);
            }
        }
        
        function toggleCourseDropdown() {
            const list = document.getElementById('courseDropdownList');
            if (!list) return;
            
            list.classList.toggle('show');
            if (list.classList.contains('show')) {
                populateCourseDropdown();
            }
        }
        
        function populateCourseDropdown() {
            const list = document.getElementById('courseDropdownList');
            if (!list) {
                console.log('Course dropdown list not found - screen not loaded yet');
                return; // Screen not loaded yet
            }
            
            list.innerHTML = '';
            
            if (savedCourses.length === 0) {
                list.innerHTML = '<div class="custom-dropdown-item" style="color: var(--grass); font-style: italic;">No saved courses</div>';
                return;
            }
            
            savedCourses.forEach((course, index) => {
                const item = document.createElement('div');
                item.className = 'custom-dropdown-item';
                item.innerHTML = `
                    <span onclick="selectCourse(${index})">${course.displayName}</span>
                    <span class="delete-icon" onclick="event.stopPropagation(); deleteCourseByIndex(${index})">üóëÔ∏è</span>
                `;
                list.appendChild(item);
            });
        }
        
        function selectCourse(index) {
            const course = savedCourses[index];
            document.getElementById('selectedCourseText').textContent = course.displayName;
            document.getElementById('courseDropdownList').classList.remove('show');
            loadCourse(index);
        }
        
        function deleteCourseByIndex(index) {
            const course = savedCourses[index];
            if (confirm(`Delete "${course.displayName}"?`)) {
                savedCourses.splice(index, 1);
                localStorage.setItem('golfCourses', JSON.stringify(savedCourses));
                populateCourseDropdown();
                document.getElementById('selectedCourseText').textContent = '-- Select Saved Course --';
            }
        }
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('courseDropdown');
            if (dropdown && !dropdown.contains(event.target)) {
                document.getElementById('courseDropdownList').classList.remove('show');
            }
        });
        
        function loadCourse(index) {
            if (index === '' || index < 0) return;
            
            const course = savedCourses[index];
            pars = [...course.pars];
            handicapIndex = [...course.handicapIndex];
            courseRating = course.rating;
            courseSlope = course.slope;
            
            // Populate manual entry fields so user can verify
            document.getElementById('manualCourseName').value = course.name;
            document.getElementById('manualTeeName').value = course.tees;
            document.getElementById('manualPars').value = course.pars.join(',');
            document.getElementById('manualHandicaps').value = course.handicapIndex.join(',');
            if (course.rating) document.getElementById('courseRating').value = course.rating;
            if (course.slope) document.getElementById('courseSlope').value = course.slope;
            
            // User can review and click Continue
        }
        
        function savePlayer() {
            try {
                console.log('Save player called');
                
                const playerName = prompt('Enter player name:');
                console.log('Player name:', playerName);
                
                if (!playerName || playerName.trim() === '') {
                    console.log('No player name provided');
                    return;
                }
                
                const handicapStr = prompt('Enter default handicap:');
                console.log('Handicap string:', handicapStr);
                
                if (!handicapStr || handicapStr.trim() === '') {
                    console.log('No handicap provided');
                    return;
                }
                
                const handicap = parseInt(handicapStr);
                if (isNaN(handicap)) {
                    alert('Please enter a valid number for handicap');
                    return;
                }
                
                const player = {
                    name: playerName.trim(),
                    handicap: handicap
                };
                
                console.log('Saving player:', player);
                
                savedPlayers.push(player);
                localStorage.setItem('golfPlayers', JSON.stringify(savedPlayers));
                
                alert(`Player "${playerName}" saved!`);
                updateSavedPlayersDropdowns();
                
                console.log('Player saved successfully');
            } catch (error) {
                console.error('Error saving player:', error);
                alert('Error saving player: ' + error.message);
            }
        }
        
        function loadPlayer(selectId, nameInputId, hcpInputId) {
            const select = document.getElementById(selectId);
            const index = select.value;
            
            if (index === '' || index < 0) return;
            
            const player = savedPlayers[index];
            document.getElementById(nameInputId).value = player.name;
            document.getElementById(hcpInputId).value = player.handicap;
            
            // Refresh all player dropdowns to remove selected players
            refreshPlayerDropdowns();
        }
        
        function deletePlayerFromDropdown() {
            if (savedPlayers.length === 0) {
                alert('No saved players to delete.');
                return;
            }
            
            let message = 'Saved Players:\n\n';
            savedPlayers.forEach((player, index) => {
                message += `${index + 1}. ${player.name} (${Number(player.handicap).toFixed(1)})\n`;
            });
            message += '\nEnter the number of the player to delete, or click Cancel:';
            
            const response = prompt(message);
            
            if (response === null) return;
            
            const playerNum = parseInt(response);
            
            if (isNaN(playerNum) || playerNum < 1 || playerNum > savedPlayers.length) {
                alert('Invalid player number.');
                return;
            }
            
            const playerToDelete = savedPlayers[playerNum - 1];
            const confirmDelete = confirm(`Delete ${playerToDelete.name}?`);
            
            if (confirmDelete) {
                savedPlayers.splice(playerNum - 1, 1);
                localStorage.setItem('golfPlayers', JSON.stringify(savedPlayers));
                alert(`${playerToDelete.name} deleted.`);
            }
        }
        
        function refreshPlayerDropdowns() {
            // Get all currently selected player names
            const selectedPlayers = new Set();
            
            // Check skins players
            for (let i = 1; i <= 4; i++) {
                const nameInput = document.getElementById(`skinsPlayer${i}`);
                if (nameInput && nameInput.value) {
                    selectedPlayers.add(nameInput.value);
                }
            }
            
            // Check team players
            const teamInputs = ['team1p1', 'team1p2', 'team2p1', 'team2p2'];
            teamInputs.forEach(id => {
                const nameInput = document.getElementById(id);
                if (nameInput && nameInput.value) {
                    selectedPlayers.add(nameInput.value);
                }
            });
            
            console.log('Selected players:', Array.from(selectedPlayers));
            
            // Update all dropdowns
            const dropdownIds = ['skinsP1Select', 'skinsP2Select', 'skinsP3Select', 'skinsP4Select',
                                 'team1p1Select', 'team1p2Select', 'team2p1Select', 'team2p2Select'];
            
            dropdownIds.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (!select) return; // Skip if element doesn't exist yet
                
                // Get the corresponding name input to see which player THIS dropdown has selected
                let correspondingName = '';
                if (selectId.startsWith('skinsP')) {
                    const num = selectId.match(/\d+/)[0];
                    const nameInput = document.getElementById(`skinsPlayer${num}`);
                    if (nameInput) correspondingName = nameInput.value;
                } else {
                    const inputId = selectId.replace('Select', '');
                    const nameInput = document.getElementById(inputId);
                    if (nameInput) correspondingName = nameInput.value;
                }
                
                const currentValue = select.value;
                select.innerHTML = '<option value="">-- Select Player --</option>';
                
                savedPlayers.forEach((player, index) => {
                    // Don't show this player if they're selected elsewhere
                    // UNLESS this is the dropdown for that player
                    if (selectedPlayers.has(player.name) && player.name !== correspondingName) {
                        return; // Skip this player
                    }
                    
                    const option = document.createElement('option');
                    option.value = index;
                    const hcpDisplay = Number(player.handicap).toFixed(1);
                    option.textContent = `${player.name} (${hcpDisplay})`;
                    select.appendChild(option);
                });
                
                // Try to restore the previous selection
                select.value = currentValue;
            });
        }
        
        function updateSavedPlayersDropdowns() {
            // Just call refresh which handles filtering selected players
            refreshPlayerDropdowns();
        }
        
        // Initialize on page load
        loadSavedCourses();
        loadSavedPlayers();
        
        let skinsGame = {
            playerCount: 3,
            players: [],
            handicaps: [],
            courseHandicaps: [],
            skinValue: 5,
            birdieMultiplier: false,
            currentHole: 0,
            scores: [],
            skins: [],
            carryover: 0
        };

        let teamMatch = {
            team1: { player1: '', player2: '', hcp1: 0, hcp2: 0 },
            team2: { player1: '', player2: '', hcp1: 0, hcp2: 0 },
            pointValue: 5,
            birdieMultiplier: false,
            currentHole: 0,
            scores: Array(18).fill(null).map(() => ({
                team1p1: null, team1p2: null, team2p1: null, team2p2: null
            })),
            skins: { team1: 0, team2: 0, carryover: 0 },
            nassau: { front9: { team1: 0, team2: 0 }, back9: { team1: 0, team2: 0 }, overall: { team1: 0, team2: 0 } },
            scotch: { team1: 0, team2: 0 }
        };

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function selectMode(mode) {
            currentMode = mode;
            showScreen('courseDataScreen');
        }

        function selectDataEntryMethod(method) {
            dataEntryMethod = method;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            if (method === 'upload') {
                document.getElementById('uploadOption').classList.remove('hidden');
                document.getElementById('manualOption').classList.add('hidden');
            } else {
                document.getElementById('uploadOption').classList.add('hidden');
                document.getElementById('manualOption').classList.remove('hidden');
            }
        }

        function saveManualCourseData() {
            try {
                const courseName = document.getElementById('manualCourseName').value.trim();
                const teeName = document.getElementById('manualTeeName').value.trim();
                const parsInput = document.getElementById('manualPars').value.trim();
                const handicapsInput = document.getElementById('manualHandicaps').value.trim();
                
                if (!courseName) {
                    alert('Please enter a course name');
                    return;
                }
                
                if (!teeName) {
                    alert('Please enter a tee name');
                    return;
                }
                
                if (!parsInput || !handicapsInput) {
                    alert('Please enter both pars and handicap indexes');
                    return;
                }
                
                // Parse the inputs
                const parsArray = parsInput.split(',').map(x => parseInt(x.trim()));
                const handicapsArray = handicapsInput.split(',').map(x => parseInt(x.trim()));
                
                if (parsArray.length !== 18 || handicapsArray.length !== 18) {
                    alert('Please enter exactly 18 values for both pars and handicap indexes');
                    return;
                }
                
                if (parsArray.some(isNaN) || handicapsArray.some(isNaN)) {
                    alert('Please enter valid numbers only');
                    return;
                }
                
                // Set the global variables
                pars = parsArray;
                handicapIndex = handicapsArray;
                
                const ratingInput = document.getElementById('courseRating').value;
                const slopeInput = document.getElementById('courseSlope').value;
                
                if (ratingInput) courseRating = parseFloat(ratingInput);
                if (slopeInput) courseSlope = parseInt(slopeInput);
                
                // Auto-save the course
                const course = {
                    name: courseName,
                    tees: teeName,
                    displayName: `${courseName} (${teeName})`,
                    pars: [...pars],
                    handicapIndex: [...handicapIndex],
                    rating: courseRating,
                    slope: courseSlope
                };
                
                // Check if this course already exists
                const existingIndex = savedCourses.findIndex(c => 
                    c.name === course.name && c.tees === course.tees
                );
                
                if (existingIndex >= 0) {
                    // Silently update existing course
                    savedCourses[existingIndex] = course;
                } else {
                    // Add new course
                    savedCourses.push(course);
                }
                
                localStorage.setItem('golfCourses', JSON.stringify(savedCourses));
                
                if (currentMode === 'skins') {
                    showScreen('skinsSetupScreen');
                } else {
                    showScreen('teamSetupScreen');
                }
            } catch (error) {
                alert('Error parsing course data. Please check your input.');
                console.error('Error in saveManualCourseData:', error);
            }
        }
        }

        function selectPlayerCount(count) {
            skinsPlayerCount = count;
            document.querySelectorAll('.player-count-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
            
            for (let i = 1; i <= 4; i++) {
                const group = document.getElementById(`skinsP${i}Group`);
                if (i <= count) {
                    group.classList.remove('hidden');
                } else {
                    group.classList.add('hidden');
                }
            }
        }

        function backToSetup() {
            const confirmBack = confirm('Go back to setup? (Current scores will be lost)');
            if (confirmBack) {
                if (currentMode === 'skins') {
                    showScreen('skinsSetupScreen');
                } else {
                    showScreen('teamSetupScreen');
                }
            }
        }
        
        function resetApp() {
            pars = [4, 5, 3, 4, 4, 3, 5, 4, 4, 4, 3, 5, 4, 4, 3, 4, 5, 4];
            handicapIndex = [1, 3, 15, 5, 11, 17, 7, 9, 13, 2, 16, 4, 6, 12, 18, 8, 10, 14];
            courseRating = null;
            courseSlope = null;
            currentMode = '';
            skinsPlayerCount = 3;
            dataEntryMethod = 'upload';
            skinsGame = {
                playerCount: 3,
                players: [],
                handicaps: [],
                skinValue: 5,
                birdieMultiplier: false,
                currentHole: 0,
                scores: [],
                skins: [],
                carryover: 0
            };
            teamMatch = {
                team1: { player1: '', player2: '', hcp1: 0, hcp2: 0 },
                team2: { player1: '', player2: '', hcp1: 0, hcp2: 0 },
                pointValue: 5,
                birdieMultiplier: false,
                currentHole: 0,
                scores: Array(18).fill(null).map(() => ({
                    team1p1: null, team1p2: null, team2p1: null, team2p2: null
                })),
                skins: { team1: 0, team2: 0, carryover: 0 },
                nassau: { front9: { team1: 0, team2: 0 }, back9: { team1: 0, team2: 0 }, overall: { team1: 0, team2: 0 } },
                scotch: { team1: 0, team2: 0 }
            };
            document.getElementById('scorecardPreview').style.display = 'none';
            document.getElementById('manualCourseName').value = '';
            document.getElementById('manualTeeName').value = '';
            document.getElementById('manualPars').value = '';
            document.getElementById('manualHandicaps').value = '';
            document.getElementById('courseRating').value = '';
            document.getElementById('courseSlope').value = '';
            showScreen('modeScreen');
        }

        // Upload handling
        const uploadArea = document.getElementById('uploadArea');
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleScorecardFile(files[0]);
            }
        });

        async function handleScorecardUpload(event) {
            const file = event.target.files[0];
            if (file) {
                handleScorecardFile(file);
            }
        }

        async function handleScorecardFile(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const preview = document.getElementById('scorecardPreview');
                preview.src = e.target.result;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(file);

            document.getElementById('loadingArea').style.display = 'block';

            try {
                const base64Data = await fileToBase64(file);
                const parsedData = await parseScorecardWithClaude(base64Data);
                
                if (parsedData && parsedData.pars && parsedData.handicapIndex) {
                    pars = parsedData.pars;
                    handicapIndex = parsedData.handicapIndex;
                    document.getElementById('loadingArea').style.display = 'none';
                    
                    // Automatically prompt for course name and tees to save
                    const courseName = window.prompt('Enter course name (e.g., "Ocean Course"):');
                    if (courseName && courseName.trim()) {
                        const teeName = window.prompt('Enter tee name (e.g., "Blue Tees"):');
                        if (teeName && teeName.trim()) {
                            // Auto-save the course
                            const course = {
                                name: courseName.trim(),
                                tees: teeName.trim(),
                                displayName: `${courseName.trim()} (${teeName.trim()})`,
                                pars: [...pars],
                                handicapIndex: [...handicapIndex],
                                rating: courseRating,
                                slope: courseSlope
                            };
                            
                            // Check if this course already exists
                            const existingIndex = savedCourses.findIndex(c => 
                                c.name === course.name && c.tees === course.tees
                            );
                            
                            if (existingIndex >= 0) {
                                // Silently update existing course
                                savedCourses[existingIndex] = course;
                            } else {
                                // Add new course
                                savedCourses.push(course);
                            }
                            
                            localStorage.setItem('golfCourses', JSON.stringify(savedCourses));
                            updateSavedCoursesDropdown();
                        }
                    }
                    
                    if (currentMode === 'skins') {
                        showScreen('skinsSetupScreen');
                    } else {
                        showScreen('teamSetupScreen');
                    }
                } else {
                    throw new Error('Could not parse scorecard');
                }
            } catch (error) {
                console.error('Error parsing scorecard:', error);
                alert('Could not read scorecard. Please try manual entry or upload a clearer photo.');
                document.getElementById('loadingArea').style.display = 'none';
            }
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        async function parseScorecardWithClaude(base64Image) {
            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 1000,
                        messages: [{
                            role: 'user',
                            content: [
                                {
                                    type: 'image',
                                    source: {
                                        type: 'base64',
                                        media_type: 'image/jpeg',
                                        data: base64Image
                                    }
                                },
                                {
                                    type: 'text',
                                    text: 'Extract the par values and handicap/stroke index for all 18 holes from this golf scorecard. Return ONLY a JSON object with this format: {"pars": [4,5,3,4,4,3,5,4,4,4,3,5,4,4,3,4,5,4], "handicapIndex": [1,3,15,5,11,17,7,9,13,2,16,4,6,12,18,8,10,14]}. Both arrays should have exactly 18 numbers representing holes 1-18 in order. The handicap index is also called stroke index or SI.'
                                }
                            ]
                        }]
                    })
                });

                const data = await response.json();
                const text = data.content.find(c => c.type === 'text')?.text;
                
                if (text) {
                    const cleaned = text.replace(/```json|```/g, '').trim();
                    return JSON.parse(cleaned);
                }
            } catch (error) {
                console.error('Claude API error:', error);
                throw error;
            }
        }

        function getStrokesForHole(holeIndex, playerHandicap, lowestHandicap) {
            const handicapDiff = playerHandicap - lowestHandicap;
            if (handicapDiff <= 0) return 0;
            
            const holeHcp = handicapIndex[holeIndex];
            if (handicapDiff >= holeHcp) {
                return Math.floor(handicapDiff / 18) + (handicapDiff % 18 >= holeHcp ? 1 : 0);
            }
            return 0;
        }

        function getLowestHandicap(handicaps) {
            return Math.min(...handicaps);
        }
        
        function calculateCourseHandicap(handicapIndex, courseRating, courseSlope) {
            // Course Handicap = (Handicap Index √ó Slope Rating / 113) + (Course Rating - Par)
            if (!courseRating || !courseSlope) {
                // If no course rating/slope provided, use handicap index as course handicap
                return Math.round(handicapIndex);
            }
            
            const totalPar = pars.reduce((sum, par) => sum + par, 0);
            const courseHandicap = (handicapIndex * courseSlope / 113) + (courseRating - totalPar);
            return Math.round(courseHandicap);
        }
        
        function doesPlayerGetStroke(holeIndex, playerCourseHandicap, lowestCourseHandicap) {
            const handicapDiff = playerCourseHandicap - lowestCourseHandicap;
            if (handicapDiff <= 0) return false;
            
            const holeHcp = handicapIndex[holeIndex];
            // Player gets stroke if their handicap difference is >= this hole's handicap index
            return handicapDiff >= holeHcp || Math.floor(handicapDiff / 18) > 0 && (handicapDiff % 18 >= holeHcp);
        }

        // SKINS MODE
        function startSkins() {
            skinsGame.playerCount = skinsPlayerCount;
            skinsGame.players = [];
            skinsGame.handicaps = [];
            skinsGame.courseHandicaps = [];
            
            for (let i = 1; i <= skinsPlayerCount; i++) {
                const name = document.getElementById(`skinsPlayer${i}`).value || `Player ${i}`;
                const hcpIndex = parseFloat(document.getElementById(`skinsHcp${i}`).value) || 0;
                const courseHcp = calculateCourseHandicap(hcpIndex, courseRating, courseSlope);
                
                skinsGame.players.push(name);
                skinsGame.handicaps.push(hcpIndex);
                skinsGame.courseHandicaps.push(courseHcp);
                
                console.log(`${name}: Index ${hcpIndex} ‚Üí Course Handicap ${courseHcp}`);
                
                // Auto-save player if they have a name and it's not a default name
                if (name && !name.startsWith('Player ')) {
                    const existingIndex = savedPlayers.findIndex(p => p.name === name);
                    if (existingIndex >= 0) {
                        // Update existing player's handicap
                        savedPlayers[existingIndex].handicap = hcpIndex;
                    } else {
                        // Add new player
                        savedPlayers.push({ name: name, handicap: hcpIndex });
                    }
                }
            }
            
            // Save all players to localStorage
            localStorage.setItem('golfPlayers', JSON.stringify(savedPlayers));
            updateSavedPlayersDropdowns();
            
            skinsGame.skinValue = parseInt(document.getElementById('skinValue').value);
            skinsGame.birdieMultiplier = document.getElementById('skinsBirdieMultiplier').checked;
            skinsGame.scores = Array(18).fill(null).map(() => Array(skinsPlayerCount).fill(null));
            skinsGame.skins = Array(skinsPlayerCount).fill(0);

            buildSkinsScorecard();
            
            // Set the live multiplier checkbox to match initial setting
            document.getElementById('skinsLiveMultiplier').checked = skinsGame.birdieMultiplier;
            
            showScreen('skinsScorecardScreen');
            updateSkinsHole();
        }
        
        function managePlayers() {
            if (savedPlayers.length === 0) {
                alert('No saved players to manage.');
                return;
            }
            
            let message = 'Saved Players:\n\n';
            savedPlayers.forEach((player, index) => {
                message += `${index + 1}. ${player.name} (${Number(player.handicap).toFixed(1)})\n`;
            });
            message += '\nEnter the number of the player to delete, or click Cancel:';
            
            const response = prompt(message);
            
            if (response === null) return; // User clicked cancel
            
            const playerNum = parseInt(response);
            
            if (isNaN(playerNum) || playerNum < 1 || playerNum > savedPlayers.length) {
                alert('Invalid player number.');
                return;
            }
            
            const playerToDelete = savedPlayers[playerNum - 1];
            const confirmDelete = confirm(`Delete ${playerToDelete.name}?`);
            
            if (confirmDelete) {
                savedPlayers.splice(playerNum - 1, 1);
                localStorage.setItem('golfPlayers', JSON.stringify(savedPlayers));
                updateSavedPlayersDropdowns();
                alert(`${playerToDelete.name} deleted.`);
            }
        }
        
        function showSkinsScorecard() {
            const table = document.getElementById('skinsFullScorecardTable');
            const lowestCourseHcp = Math.min(...skinsGame.courseHandicaps);
            
            let html = '<thead class="scorecard-table"><tr><th>Hole</th>';
            
            // Hole headers
            for (let h = 0; h < 18; h++) {
                html += `<th class="hole-header">${h + 1}</th>`;
            }
            html += '<th class="total-col">Total</th></tr>';
            
            // Par row
            html += '<tr><th>Par</th>';
            for (let h = 0; h < 18; h++) {
                html += `<td>${pars[h]}</td>`;
            }
            html += `<td class="total-col">${pars.reduce((a, b) => a + b, 0)}</td></tr>`;
            
            // HCP row
            html += '<tr><th>HCP</th>';
            for (let h = 0; h < 18; h++) {
                html += `<td>${handicapIndex[h]}</td>`;
            }
            html += '<td class="total-col">-</td></tr></thead>';
            
            html += '<tbody class="scorecard-table">';
            
            // Player rows
            for (let p = 0; p < skinsGame.playerCount; p++) {
                html += `<tr class="player-row"><td style="font-weight: 700; text-align: left;">${skinsGame.players[p]}</td>`;
                
                let playerTotal = 0;
                for (let h = 0; h < 18; h++) {
                    const gross = skinsGame.scores[h][p];
                    const getsStroke = doesPlayerGetStroke(h, skinsGame.courseHandicaps[p], lowestCourseHcp);
                    
                    if (gross) {
                        playerTotal += gross;
                        const strokeIndicator = getsStroke ? '<span class="stroke-hole">*</span>' : '';
                        html += `<td>${gross}${strokeIndicator}</td>`;
                    } else {
                        const strokeIndicator = getsStroke ? '<span class="stroke-hole">*</span>' : '';
                        html += `<td>-${strokeIndicator}</td>`;
                    }
                }
                html += `<td class="total-col">${playerTotal || '-'}</td></tr>`;
            }
            
            html += '</tbody>';
            
            // Skins totals row
            html += '<tfoot class="scorecard-table"><tr style="background: linear-gradient(135deg, var(--fairway) 0%, var(--grass) 100%); color: white;"><td style="font-weight: 700;">Skins Won</td>';
            
            // Calculate skins per hole
            const skinsPerHole = Array(18).fill(null);
            let carryover = 0;
            
            for (let h = 0; h < 18; h++) {
                const scores = skinsGame.scores[h];
                if (scores.some(s => s === null)) {
                    skinsPerHole[h] = '-';
                    continue;
                }
                
                const netScores = scores.map((gross, idx) => 
                    gross - getStrokesForHole(h, skinsGame.courseHandicaps[idx], lowestCourseHcp)
                );
                const minScore = Math.min(...netScores);
                const winners = netScores.filter(s => s === minScore).length;
                
                if (winners === 1) {
                    const winnerIndex = netScores.indexOf(minScore);
                    skinsPerHole[h] = skinsGame.players[winnerIndex];
                    carryover = 0;
                } else {
                    carryover++;
                    skinsPerHole[h] = `Tie (${carryover})`;
                }
            }
            
            for (let h = 0; h < 18; h++) {
                html += `<td style="font-size: 0.75rem;">${skinsPerHole[h]}</td>`;
            }
            
            html += '<td class="total-col">-</td></tr>';
            
            // Running totals
            html += '<tr style="background: var(--forest); color: white;"><td style="font-weight: 700;">Running Total</td>';
            for (let p = 0; p < skinsGame.playerCount; p++) {
                html += `<td colspan="${Math.ceil(18 / skinsGame.playerCount)}" style="font-weight: 700;">${skinsGame.players[p]}: ${skinsGame.skins[p]}</td>`;
            }
            html += '</tr></tfoot>';
            
            table.innerHTML = html;
            showScreen('skinsFullScorecardScreen');
        }
        
        function toggleSkinsMultiplier() {
            skinsGame.birdieMultiplier = document.getElementById('skinsLiveMultiplier').checked;
            calculateSkinsStandings(); // Retroactively recalculate
        }

        function buildSkinsScorecard() {
            const inputsContainer = document.getElementById('skinsScoreInputs');
            inputsContainer.innerHTML = '';
            
            const lowestCourseHcp = Math.min(...skinsGame.courseHandicaps);
            
            for (let i = 0; i < skinsGame.playerCount; i++) {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'player-score';
                playerDiv.innerHTML = `
                    <label>${skinsGame.players[i]}</label>
                    <div style="text-align: center; font-size: 0.75rem; color: var(--grass); margin-bottom: 5px;">
                        Course Handicap: ${skinsGame.courseHandicaps[i]}
                    </div>
                    <div class="score-labels">
                        <span>Gross</span>
                        <span>Net</span>
                        <span style="width: 15px;"></span>
                    </div>
                    <div class="score-input-row">
                        <input type="text" inputmode="numeric" pattern="[0-9]*" id="skinsP${i+1}Score" onchange="handleSkinsScoreInput()">
                        <div class="net-box" id="skinsP${i+1}Net">-</div>
                        <div class="stroke-indicator" id="skinsP${i+1}Stroke"></div>
                    </div>
                `;
                inputsContainer.appendChild(playerDiv);
            }

            const standingsContainer = document.getElementById('skinsStandingsList');
            standingsContainer.innerHTML = '';
            
            for (let i = 0; i < skinsGame.playerCount; i++) {
                const standingDiv = document.createElement('div');
                standingDiv.className = 'standing-item';
                standingDiv.innerHTML = `
                    <span id="skinsName${i+1}">${skinsGame.players[i]}</span>
                    <span id="skinsCount${i+1}">0</span>
                `;
                standingsContainer.appendChild(standingDiv);
            }
        }

        function updateSkinsHole() {
            const hole = skinsGame.currentHole;
            document.getElementById('skinsHoleNumber').textContent = `Hole ${hole + 1}`;
            document.getElementById('skinsHolePar').textContent = `Par ${pars[hole]}`;
            document.getElementById('skinsHoleHcp').textContent = `Handicap ${handicapIndex[hole]}`;

            for (let i = 0; i < skinsGame.playerCount; i++) {
                document.getElementById(`skinsP${i+1}Score`).value = skinsGame.scores[hole][i] || '';
            }

            updateSkinsScoreDisplay();

            document.getElementById('skinsPrevBtn').disabled = hole === 0;
            document.getElementById('skinsNextBtn').disabled = false; // Always enabled
            
            // Only show finish button on hole 18
            if (hole === 17) {
                document.getElementById('skinsFinishBtn').style.display = 'block';
            } else {
                document.getElementById('skinsFinishBtn').style.display = 'none';
            }
        }

        function updateSkinsScoreDisplay() {
            const hole = skinsGame.currentHole;
            const lowestCourseHcp = Math.min(...skinsGame.courseHandicaps);
            
            console.log(`=== HOLE ${hole + 1} SCORE UPDATE ===`);
            console.log(`Lowest course handicap: ${lowestCourseHcp}`);
            
            for (let i = 0; i < skinsGame.playerCount; i++) {
                const grossInput = document.getElementById(`skinsP${i+1}Score`);
                const netElement = document.getElementById(`skinsP${i+1}Net`);
                const strokeElement = document.getElementById(`skinsP${i+1}Stroke`);
                
                if (!grossInput || !netElement || !strokeElement) {
                    console.log(`Player ${i+1}: Missing elements`);
                    continue;
                }
                
                const rawValue = grossInput.value;
                const getsStroke = doesPlayerGetStroke(hole, skinsGame.courseHandicaps[i], lowestCourseHcp);
                
                // Update stroke indicator
                strokeElement.textContent = getsStroke ? '*' : '';
                
                if (!rawValue || rawValue === '') {
                    netElement.textContent = '-';
                    console.log(`Player ${i+1}: Empty input`);
                    continue;
                }
                
                // Parse with base 10 explicitly
                const grossScore = parseInt(rawValue, 10);
                
                if (isNaN(grossScore) || grossScore <= 0) {
                    netElement.textContent = '-';
                    console.log(`Player ${i+1}: Invalid number "${rawValue}"`);
                    continue;
                }
                
                console.log(`Player ${i+1} (${skinsGame.players[i]}):`);
                console.log(`  Raw input: "${rawValue}"`);
                console.log(`  Gross score: ${grossScore}`);
                console.log(`  Course handicap: ${skinsGame.courseHandicaps[i]}`);
                console.log(`  Lowest course handicap: ${lowestCourseHcp}`);
                
                const strokesReceived = getStrokesForHole(hole, skinsGame.courseHandicaps[i], lowestCourseHcp);
                console.log(`  Strokes received: ${strokesReceived}`);
                console.log(`  Gets stroke on this hole: ${getsStroke}`);
                
                const netScore = grossScore - strokesReceived;
                console.log(`  Net calculation: ${grossScore} - ${strokesReceived} = ${netScore}`);
                
                netElement.textContent = netScore.toString();
                console.log(`  Display: ${netScore} with stroke indicator: ${getsStroke ? '*' : 'none'}`);
            }
            console.log('=== END UPDATE ===\n');
        }

        function saveSkinsHole() {
            const hole = skinsGame.currentHole;
            for (let i = 0; i < skinsGame.playerCount; i++) {
                skinsGame.scores[hole][i] = parseInt(document.getElementById(`skinsP${i+1}Score`).value) || null;
            }
        }

        function handleSkinsScoreInput() {
            updateSkinsScoreDisplay();
            saveSkinsHole();
            calculateSkinsStandings();
        }

        function skinsPrevHole() {
            if (skinsGame.currentHole > 0) {
                saveSkinsHole();
                skinsGame.currentHole--;
                updateSkinsHole();
                calculateSkinsStandings();
            }
        }

        function skinsNextHole() {
            if (skinsGame.currentHole < 17) {
                saveSkinsHole();
                skinsGame.currentHole++;
                updateSkinsHole();
                calculateSkinsStandings();
            } else {
                // On hole 18, show the finish button
                saveSkinsHole();
                calculateSkinsStandings();
                document.getElementById('skinsFinishBtn').style.display = 'block';
            }
        }

        function calculateSkinsStandings() {
            saveSkinsHole();
            skinsGame.skins = Array(skinsGame.playerCount).fill(0);
            skinsGame.carryover = 0;
            
            const lowestCourseHcp = Math.min(...skinsGame.courseHandicaps);

            for (let i = 0; i <= skinsGame.currentHole; i++) {
                const scores = skinsGame.scores[i];
                if (scores.some(s => s === null)) continue;

                const netScores = scores.map((gross, idx) => 
                    gross - getStrokesForHole(i, skinsGame.courseHandicaps[idx], lowestCourseHcp)
                );
                const minScore = Math.min(...netScores);
                const winners = netScores.filter(s => s === minScore).length;

                if (winners === 1) {
                    const winnerIndex = netScores.indexOf(minScore);
                    let skinsWon = 1 + skinsGame.carryover;
                    
                    console.log(`Hole ${i+1}: Winner is ${skinsGame.players[winnerIndex]}`);
                    console.log(`  Gross: ${scores[winnerIndex]}, Net: ${minScore}, Par: ${pars[i]}`);
                    console.log(`  Birdie multiplier enabled: ${skinsGame.birdieMultiplier}`);
                    
                    if (skinsGame.birdieMultiplier) {
                        const par = pars[i];
                        const winnerGrossScore = scores[winnerIndex]; // Use GROSS score for multiplier
                        console.log(`  Checking multiplier: Gross ${winnerGrossScore} vs Par ${par}`);
                        if (winnerGrossScore === par - 1) {
                            skinsWon *= 2; // Birdie
                            console.log(`  BIRDIE! 2x multiplier applied. Skins won: ${skinsWon}`);
                        } else if (winnerGrossScore <= par - 2) {
                            skinsWon *= 4; // Eagle or better
                            console.log(`  EAGLE! 4x multiplier applied. Skins won: ${skinsWon}`);
                        } else {
                            console.log(`  No multiplier. Skins won: ${skinsWon}`);
                        }
                    }
                    
                    skinsGame.skins[winnerIndex] += skinsWon;
                    skinsGame.carryover = 0;
                } else {
                    skinsGame.carryover += 1;
                }
            }

            for (let i = 0; i < skinsGame.playerCount; i++) {
                document.getElementById(`skinsCount${i+1}`).textContent = skinsGame.skins[i];
            }

            const carryoverDiv = document.getElementById('skinsCarryover');
            if (skinsGame.carryover > 0) {
                carryoverDiv.style.display = 'block';
                carryoverDiv.textContent = `Carryover: ${skinsGame.carryover} skin${skinsGame.carryover > 1 ? 's' : ''}`;
            } else {
                carryoverDiv.style.display = 'none';
            }
        }

        function finishSkinsGame() {
            saveSkinsHole();
            calculateSkinsStandings();

            let html = '';
            const totalSkins = skinsGame.skins.reduce((a, b) => a + b, 0);
            const skinValue = skinsGame.skinValue;

            for (let i = 0; i < skinsGame.playerCount; i++) {
                const won = skinsGame.skins[i] * skinValue;
                const lost = (totalSkins - skinsGame.skins[i]) * skinValue / (skinsGame.playerCount - 1);
                const net = won - lost;
                
                html += `
                    <div style="padding: 15px; background: rgba(255,255,255,0.1); border-radius: 12px; margin-bottom: 10px;">
                        <div style="font-size: 1.3rem; font-weight: 700;">${skinsGame.players[i]}</div>
                        <div style="font-size: 1.1rem; margin: 8px 0;">${skinsGame.skins[i]} skins</div>
                        <div style="font-size: 1.5rem; color: var(--sand); font-weight: 900;">
                            ${net >= 0 ? '+' : ''}$${Math.round(net)}
                        </div>
                    </div>
                `;
            }

            document.getElementById('skinsResultsList').innerHTML = html;
            showScreen('skinsResultsScreen');
        }

        // TEAM MODE
        function startTeam() {
            teamMatch.team1.player1 = document.getElementById('team1p1').value || 'Team 1 Player 1';
            teamMatch.team1.player2 = document.getElementById('team1p2').value || 'Team 1 Player 2';
            teamMatch.team2.player1 = document.getElementById('team2p1').value || 'Team 2 Player 1';
            teamMatch.team2.player2 = document.getElementById('team2p2').value || 'Team 2 Player 2';
            teamMatch.team1.hcp1 = parseInt(document.getElementById('team1p1Hcp').value) || 0;
            teamMatch.team1.hcp2 = parseInt(document.getElementById('team1p2Hcp').value) || 0;
            teamMatch.team2.hcp1 = parseInt(document.getElementById('team2p1Hcp').value) || 0;
            teamMatch.team2.hcp2 = parseInt(document.getElementById('team2p2Hcp').value) || 0;
            teamMatch.pointValue = parseInt(document.getElementById('pointValue').value);
            teamMatch.birdieMultiplier = document.getElementById('teamBirdieMultiplier').checked;
            
            // Auto-save all players
            const players = [
                { name: teamMatch.team1.player1, hcp: teamMatch.team1.hcp1 },
                { name: teamMatch.team1.player2, hcp: teamMatch.team1.hcp2 },
                { name: teamMatch.team2.player1, hcp: teamMatch.team2.hcp1 },
                { name: teamMatch.team2.player2, hcp: teamMatch.team2.hcp2 }
            ];
            
            players.forEach(p => {
                if (p.name && !p.name.startsWith('Team ')) {
                    const existingIndex = savedPlayers.findIndex(sp => sp.name === p.name);
                    if (existingIndex >= 0) {
                        savedPlayers[existingIndex].handicap = p.hcp;
                    } else {
                        savedPlayers.push({ name: p.name, handicap: p.hcp });
                    }
                }
            });
            
            localStorage.setItem('golfPlayers', JSON.stringify(savedPlayers));
            updateSavedPlayersDropdowns();

            document.getElementById('teamT1P1Label').textContent = teamMatch.team1.player1;
            document.getElementById('teamT1P2Label').textContent = teamMatch.team1.player2;
            document.getElementById('teamT2P1Label').textContent = teamMatch.team2.player1;
            document.getElementById('teamT2P2Label').textContent = teamMatch.team2.player2;
            
            // Set the live multiplier checkbox to match initial setting
            document.getElementById('teamLiveMultiplier').checked = teamMatch.birdieMultiplier;

            showScreen('teamScorecardScreen');
            updateTeamHole();
        }
        
        function toggleTeamMultiplier() {
            teamMatch.birdieMultiplier = document.getElementById('teamLiveMultiplier').checked;
            calculateTeamStandings(); // Retroactively recalculate
        }

        function updateTeamHole() {
            const hole = teamMatch.currentHole;
            document.getElementById('teamHoleNumber').textContent = `Hole ${hole + 1}`;
            document.getElementById('teamHolePar').textContent = `Par ${pars[hole]}`;
            document.getElementById('teamHoleHcp').textContent = `Handicap ${handicapIndex[hole]}`;

            const scores = teamMatch.scores[hole];
            document.getElementById('teamT1P1Score').value = scores.team1p1 || '';
            document.getElementById('teamT1P2Score').value = scores.team1p2 || '';
            document.getElementById('teamT2P1Score').value = scores.team2p1 || '';
            document.getElementById('teamT2P2Score').value = scores.team2p2 || '';

            updateTeamScoreDisplay();

            document.getElementById('teamPrevBtn').disabled = hole === 0;
            document.getElementById('teamNextBtn').disabled = false; // Always enabled
            
            // Only show finish button on hole 18
            if (hole === 17) {
                document.getElementById('teamFinishBtn').style.display = 'block';
            } else {
                document.getElementById('teamFinishBtn').style.display = 'none';
            }
        }

        function updateTeamScoreDisplay() {
            const hole = teamMatch.currentHole;
            const scores = teamMatch.scores[hole];
            
            const allHandicaps = [teamMatch.team1.hcp1, teamMatch.team1.hcp2, teamMatch.team2.hcp1, teamMatch.team2.hcp2];
            const lowestHcp = getLowestHandicap(allHandicaps);
            
            const players = [
                { scoreId: 'teamT1P1Score', hcp: teamMatch.team1.hcp1, netId: 'teamT1P1Net' },
                { scoreId: 'teamT1P2Score', hcp: teamMatch.team1.hcp2, netId: 'teamT1P2Net' },
                { scoreId: 'teamT2P1Score', hcp: teamMatch.team2.hcp1, netId: 'teamT2P1Net' },
                { scoreId: 'teamT2P2Score', hcp: teamMatch.team2.hcp2, netId: 'teamT2P2Net' }
            ];

            players.forEach(p => {
                const grossInput = document.getElementById(p.scoreId);
                const netElement = document.getElementById(p.netId);
                
                if (grossInput && netElement) {
                    const gross = parseInt(grossInput.value);
                    
                    if (gross && !isNaN(gross)) {
                        const strokes = getStrokesForHole(hole, p.hcp, lowestHcp);
                        const net = gross - strokes;
                        netElement.textContent = net.toString();
                    } else {
                        netElement.textContent = '-';
                    }
                }
            });
        }

        function saveTeamHole() {
            const hole = teamMatch.currentHole;
            teamMatch.scores[hole].team1p1 = parseInt(document.getElementById('teamT1P1Score').value) || null;
            teamMatch.scores[hole].team1p2 = parseInt(document.getElementById('teamT1P2Score').value) || null;
            teamMatch.scores[hole].team2p1 = parseInt(document.getElementById('teamT2P1Score').value) || null;
            teamMatch.scores[hole].team2p2 = parseInt(document.getElementById('teamT2P2Score').value) || null;
        }

        function handleTeamScoreInput() {
            updateTeamScoreDisplay();
            saveTeamHole();
            calculateTeamStandings();
        }

        function teamPrevHole() {
            if (teamMatch.currentHole > 0) {
                saveTeamHole();
                teamMatch.currentHole--;
                updateTeamHole();
                calculateTeamStandings();
            }
        }

        function teamNextHole() {
            if (teamMatch.currentHole < 17) {
                saveTeamHole();
                teamMatch.currentHole++;
                updateTeamHole();
                calculateTeamStandings();
            } else {
                // On hole 18, show the finish button
                saveTeamHole();
                calculateTeamStandings();
                document.getElementById('teamFinishBtn').style.display = 'block';
            }
        }

        function calculateTeamStandings() {
            saveTeamHole();

            teamMatch.skins = { team1: 0, team2: 0, carryover: 0 };
            teamMatch.nassau = { front9: { team1: 0, team2: 0 }, back9: { team1: 0, team2: 0 }, overall: { team1: 0, team2: 0 } };
            teamMatch.scotch = { team1: 0, team2: 0 };
            
            const allHandicaps = [teamMatch.team1.hcp1, teamMatch.team1.hcp2, teamMatch.team2.hcp1, teamMatch.team2.hcp2];
            const lowestHcp = getLowestHandicap(allHandicaps);

            for (let i = 0; i <= teamMatch.currentHole; i++) {
                const hole = teamMatch.scores[i];
                if (!hole.team1p1 || !hole.team1p2 || !hole.team2p1 || !hole.team2p2) continue;

                const t1p1Net = hole.team1p1 - getStrokesForHole(i, teamMatch.team1.hcp1, lowestHcp);
                const t1p2Net = hole.team1p2 - getStrokesForHole(i, teamMatch.team1.hcp2, lowestHcp);
                const t2p1Net = hole.team2p1 - getStrokesForHole(i, teamMatch.team2.hcp1, lowestHcp);
                const t2p2Net = hole.team2p2 - getStrokesForHole(i, teamMatch.team2.hcp2, lowestHcp);

                const team1Best = Math.min(t1p1Net, t1p2Net);
                const team2Best = Math.min(t2p1Net, t2p2Net);
                const team1Total = t1p1Net + t1p2Net;
                const team2Total = t2p1Net + t2p2Net;

                // Skins
                if (team1Best < team2Best) {
                    let skinsWon = 1 + teamMatch.skins.carryover;
                    if (teamMatch.birdieMultiplier) {
                        const par = pars[i];
                        if (team1Best === par - 1) skinsWon *= 2;
                        else if (team1Best <= par - 2) skinsWon *= 4;
                    }
                    teamMatch.skins.team1 += skinsWon;
                    teamMatch.skins.carryover = 0;
                } else if (team2Best < team1Best) {
                    let skinsWon = 1 + teamMatch.skins.carryover;
                    if (teamMatch.birdieMultiplier) {
                        const par = pars[i];
                        if (team2Best === par - 1) skinsWon *= 2;
                        else if (team2Best <= par - 2) skinsWon *= 4;
                    }
                    teamMatch.skins.team2 += skinsWon;
                    teamMatch.skins.carryover = 0;
                } else {
                    teamMatch.skins.carryover += 1;
                }

                // Nassau
                if (team1Best < team2Best) {
                    if (i < 9) teamMatch.nassau.front9.team1++;
                    else teamMatch.nassau.back9.team1++;
                    teamMatch.nassau.overall.team1++;
                } else if (team2Best < team1Best) {
                    if (i < 9) teamMatch.nassau.front9.team2++;
                    else teamMatch.nassau.back9.team2++;
                    teamMatch.nassau.overall.team2++;
                }

                // Scotch
                let scotchPts = 0;
                if (Math.min(t1p1Net, t1p2Net) < Math.min(t2p1Net, t2p2Net)) scotchPts += 2;
                else if (Math.min(t2p1Net, t2p2Net) < Math.min(t1p1Net, t1p2Net)) scotchPts -= 2;
                
                if (team1Total < team2Total) scotchPts += 2;
                else if (team2Total < team1Total) scotchPts -= 2;
                
                const birdie1 = t1p1Net < pars[i] || t1p2Net < pars[i];
                const birdie2 = t2p1Net < pars[i] || t2p2Net < pars[i];
                if (birdie1 && !birdie2) scotchPts += 1;
                else if (birdie2 && !birdie1) scotchPts -= 1;
                
                if (Math.abs(scotchPts) === 6) scotchPts *= 2;
                
                if (scotchPts > 0) teamMatch.scotch.team1 += scotchPts;
                else teamMatch.scotch.team2 += Math.abs(scotchPts);
            }

            document.getElementById('teamSkinsStanding').textContent = 
                `Team 1: ${teamMatch.skins.team1} | Team 2: ${teamMatch.skins.team2}`;
            
            const nassauT1 = (teamMatch.nassau.front9.team1 > teamMatch.nassau.front9.team2 ? 1 : 0) +
                            (teamMatch.nassau.back9.team1 > teamMatch.nassau.back9.team2 ? 1 : 0) +
                            (teamMatch.nassau.overall.team1 > teamMatch.nassau.overall.team2 ? 1 : 0);
            const nassauT2 = (teamMatch.nassau.front9.team2 > teamMatch.nassau.front9.team1 ? 1 : 0) +
                            (teamMatch.nassau.back9.team2 > teamMatch.nassau.back9.team1 ? 1 : 0) +
                            (teamMatch.nassau.overall.team2 > teamMatch.nassau.overall.team1 ? 1 : 0);
            
            document.getElementById('teamNassauStanding').textContent = `Team 1: ${nassauT1} | Team 2: ${nassauT2}`;
            document.getElementById('teamScotchStanding').textContent = 
                `Team 1: ${teamMatch.scotch.team1} | Team 2: ${teamMatch.scotch.team2}`;
        }

        function finishTeamMatch() {
            saveTeamHole();
            calculateTeamStandings();

            const pv = teamMatch.pointValue;

            const skinsWon = teamMatch.skins.team1 - teamMatch.skins.team2;
            document.getElementById('teamSkinsWinner').textContent = 
                skinsWon > 0 ? 'Team 1 Wins!' : skinsWon < 0 ? 'Team 2 Wins!' : 'Tie';
            document.getElementById('teamSkinsMoney').textContent = `$${Math.abs(skinsWon) * pv}`;

            const nassauT1 = (teamMatch.nassau.front9.team1 > teamMatch.nassau.front9.team2 ? 1 : 0) +
                            (teamMatch.nassau.back9.team1 > teamMatch.nassau.back9.team2 ? 1 : 0) +
                            (teamMatch.nassau.overall.team1 > teamMatch.nassau.overall.team2 ? 1 : 0);
            const nassauT2 = (teamMatch.nassau.front9.team2 > teamMatch.nassau.front9.team1 ? 1 : 0) +
                            (teamMatch.nassau.back9.team2 > teamMatch.nassau.back9.team1 ? 1 : 0) +
                            (teamMatch.nassau.overall.team2 > teamMatch.nassau.overall.team1 ? 1 : 0);
            const nassauWon = nassauT1 - nassauT2;
            document.getElementById('teamNassauWinner').textContent = 
                nassauWon > 0 ? 'Team 1 Wins!' : nassauWon < 0 ? 'Team 2 Wins!' : 'Tie';
            document.getElementById('teamNassauMoney').textContent = `$${Math.abs(nassauWon) * pv}`;

            const scotchWon = teamMatch.scotch.team1 - teamMatch.scotch.team2;
            document.getElementById('teamScotchWinner').textContent = 
                scotchWon > 0 ? 'Team 1 Wins!' : scotchWon < 0 ? 'Team 2 Wins!' : 'Tie';
            document.getElementById('teamScotchMoney').textContent = `$${Math.abs(scotchWon) * pv}`;

            const total = (Math.abs(skinsWon) + Math.abs(nassauWon) + Math.abs(scotchWon)) * pv;
            const totalWinner = (skinsWon + nassauWon + scotchWon) > 0 ? 'Team 1' : 
                               (skinsWon + nassauWon + scotchWon) < 0 ? 'Team 2' : 'Tie';
            document.getElementById('teamTotalWinner').textContent = totalWinner;
            document.getElementById('teamTotalMoney').textContent = `$${total}`;

            showScreen('teamResultsScreen');
        }
    </script>
</body>
</html>
