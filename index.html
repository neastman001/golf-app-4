<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Golf Betting App</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --forest: #1a4d2e;
            --grass: #4f772d;
            --fairway: #90be6d;
            --sand: #f4a259;
            --sky: #f8f9fa;
            --white: #ffffff;
            --shadow: rgba(26, 77, 46, 0.1);
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background: linear-gradient(135deg, var(--sky) 0%, #e8f5e9 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--forest);
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--forest);
            text-align: center;
            margin-bottom: 10px;
            text-shadow: 2px 2px 0 var(--fairway);
        }

        .subtitle {
            text-align: center;
            color: var(--grass);
            font-size: 0.9rem;
            margin-bottom: 30px;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .screen {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: var(--white);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px var(--shadow);
            margin-bottom: 20px;
        }

        .mode-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .mode-btn {
            padding: 30px 20px;
            background: linear-gradient(135deg, var(--fairway) 0%, var(--grass) 100%);
            color: var(--white);
            border: 3px solid transparent;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .mode-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(79, 119, 45, 0.3);
        }

        .mode-btn .icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .mode-btn .title {
            font-family: 'Playfair Display', serif;
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .mode-btn .desc {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--forest);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        input, select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--fairway);
            border-radius: 10px;
            font-size: 1rem;
            font-family: 'DM Sans', sans-serif;
            transition: all 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--grass);
            box-shadow: 0 0 0 3px rgba(79, 119, 45, 0.1);
        }

        .two-col {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 10px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: var(--sky);
            border-radius: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            cursor: pointer;
        }

        .checkbox-group label {
            margin: 0;
            font-size: 0.9rem;
            text-transform: none;
            cursor: pointer;
        }

        .upload-area {
            border: 3px dashed var(--fairway);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: var(--sky);
        }

        .upload-area:hover {
            border-color: var(--grass);
            background: #e8f5e9;
        }

        .upload-area.dragover {
            border-color: var(--grass);
            background: #e8f5e9;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        #scorecardPreview {
            max-width: 100%;
            border-radius: 10px;
            margin-top: 15px;
        }

        .team-section {
            background: linear-gradient(135deg, var(--fairway) 0%, var(--grass) 100%);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            color: var(--white);
        }

        .team-section h3 {
            font-family: 'Playfair Display', serif;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--grass) 0%, var(--forest) 100%);
            color: var(--white);
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(79, 119, 45, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(79, 119, 45, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-back {
            background: linear-gradient(135deg, var(--sand) 0%, #e76f51 100%);
            margin-top: 10px;
        }

        .scorecard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--forest) 0%, var(--grass) 100%);
            padding: 20px;
            border-radius: 15px;
            color: var(--white);
        }

        .hole-nav button {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid var(--white);
            color: var(--white);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .hole-nav button:hover:not(:disabled) {
            background: var(--white);
            color: var(--forest);
        }

        .hole-nav button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .hole-info {
            text-align: center;
        }

        .hole-info h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
        }

        .hole-info .handicap {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-top: 5px;
        }

        .score-inputs {
            display: grid;
            gap: 12px;
        }

        .player-score {
            background: var(--sky);
            padding: 10px 15px;
            border-radius: 10px;
        }

        .player-score label {
            font-size: 0.8rem;
            margin-bottom: 6px;
        }

        .player-score input {
            font-size: 1.1rem;
            font-weight: 700;
            text-align: center;
            padding: 8px;
        }

        .score-display {
            display: flex;
            justify-content: space-around;
            margin-top: 8px;
            font-size: 0.85rem;
            color: var(--grass);
        }

        .score-display span {
            font-weight: 600;
        }

        .standings {
            background: linear-gradient(135deg, var(--fairway) 0%, var(--grass) 100%);
            padding: 20px;
            border-radius: 15px;
            color: var(--white);
            margin-top: 20px;
        }

        .standings h3 {
            font-family: 'Playfair Display', serif;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.5rem;
        }

        .standing-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .standing-item:last-child {
            border-bottom: none;
        }

        .carryover {
            background: var(--sand);
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            margin-top: 12px;
            font-weight: 700;
        }

        .results-card {
            background: linear-gradient(135deg, var(--forest) 0%, var(--grass) 100%);
            color: var(--white);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 20px;
        }

        .results-card h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            margin-bottom: 20px;
            text-align: center;
        }

        .result-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
        }

        .result-section h3 {
            font-family: 'Playfair Display', serif;
            margin-bottom: 10px;
            font-size: 1.3rem;
        }

        .winner {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .money {
            color: var(--sand);
            font-size: 1.5rem;
            font-weight: 900;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: var(--grass);
        }

        .spinner {
            border: 3px solid var(--sky);
            border-top: 3px solid var(--grass);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚õ≥ GolfBet</h1>
        <p class="subtitle">Ponte Vedra Golf Betting</p>

        <!-- Mode Selection Screen -->
        <div id="modeScreen" class="screen active">
            <div class="card">
                <h2 style="font-family: 'Playfair Display', serif; margin-bottom: 25px; text-align: center;">Choose Game Mode</h2>
                
                <div class="mode-selection">
                    <div class="mode-btn" onclick="selectMode('skins')">
                        <div class="icon">üèåÔ∏è</div>
                        <div class="title">Skins</div>
                        <div class="desc">3 Players</div>
                    </div>
                    <div class="mode-btn" onclick="selectMode('team')">
                        <div class="icon">üë•</div>
                        <div class="title">Team Best Ball</div>
                        <div class="desc">2v2 Teams</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scorecard Upload Screen -->
        <div id="scorecardUploadScreen" class="screen">
            <div class="card">
                <h2 style="font-family: 'Playfair Display', serif; margin-bottom: 20px;">Upload Scorecard</h2>
                
                <div class="upload-area" id="uploadArea" onclick="document.getElementById('scorecardInput').click()">
                    <div class="upload-icon">üì∏</div>
                    <p style="font-weight: 600; margin-bottom: 5px;">Take or Upload Scorecard Photo</p>
                    <p style="font-size: 0.85rem; opacity: 0.7;">We'll read par and handicap/stroke index</p>
                    <input type="file" id="scorecardInput" accept="image/*" capture="environment" style="display: none;" onchange="handleScorecardUpload(event)">
                    <img id="scorecardPreview" style="display: none;">
                </div>

                <div id="loadingArea" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Reading scorecard...</p>
                </div>

                <button class="btn btn-back" onclick="showScreen('modeScreen')" style="margin-top: 20px;">Back</button>
            </div>
        </div>

        <!-- Skins Setup Screen -->
        <div id="skinsSetupScreen" class="screen">
            <div class="card">
                <h2 style="font-family: 'Playfair Display', serif; margin-bottom: 20px;">Skins Game Setup</h2>
                
                <div class="form-group">
                    <label>$ Per Skin</label>
                    <input type="number" id="skinValue" value="5" min="1">
                </div>

                <div class="form-group checkbox-group">
                    <input type="checkbox" id="skinsBirdieMultiplier">
                    <label for="skinsBirdieMultiplier">Birdie 2x, Eagle 4x (includes carryovers)</label>
                </div>

                <div class="form-group">
                    <label>Player 1</label>
                    <div class="two-col">
                        <input type="text" id="skinsPlayer1" placeholder="Name">
                        <input type="number" id="skinsHcp1" placeholder="Handicap" min="0" max="54">
                    </div>
                </div>

                <div class="form-group">
                    <label>Player 2</label>
                    <div class="two-col">
                        <input type="text" id="skinsPlayer2" placeholder="Name">
                        <input type="number" id="skinsHcp2" placeholder="Handicap" min="0" max="54">
                    </div>
                </div>

                <div class="form-group">
                    <label>Player 3</label>
                    <div class="two-col">
                        <input type="text" id="skinsPlayer3" placeholder="Name">
                        <input type="number" id="skinsHcp3" placeholder="Handicap" min="0" max="54">
                    </div>
                </div>

                <button class="btn" onclick="startSkins()">Start Game</button>
                <button class="btn btn-back" onclick="showScreen('scorecardUploadScreen')">Back</button>
            </div>
        </div>

        <!-- Team Setup Screen -->
        <div id="teamSetupScreen" class="screen">
            <div class="card">
                <h2 style="font-family: 'Playfair Display', serif; margin-bottom: 20px;">Team Best Ball Setup</h2>
                
                <div class="form-group">
                    <label>Point Value ($)</label>
                    <input type="number" id="pointValue" value="5" min="1">
                </div>

                <div class="form-group checkbox-group">
                    <input type="checkbox" id="teamBirdieMultiplier">
                    <label for="teamBirdieMultiplier">Birdie 2x, Eagle 4x (includes carryovers)</label>
                </div>

                <div class="team-section">
                    <h3>üèåÔ∏è Team 1</h3>
                    <div class="form-group">
                        <label style="color: white; text-transform: none;">Player 1</label>
                        <div class="two-col">
                            <input type="text" id="team1p1" placeholder="Name" style="border-color: white; margin-bottom: 10px;">
                            <input type="number" id="team1p1Hcp" placeholder="Hcp" min="0" max="54" style="border-color: white; margin-bottom: 10px;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label style="color: white; text-transform: none;">Player 2</label>
                        <div class="two-col">
                            <input type="text" id="team1p2" placeholder="Name" style="border-color: white;">
                            <input type="number" id="team1p2Hcp" placeholder="Hcp" min="0" max="54" style="border-color: white;">
                        </div>
                    </div>
                </div>

                <div class="team-section">
                    <h3>üèåÔ∏è Team 2</h3>
                    <div class="form-group">
                        <label style="color: white; text-transform: none;">Player 1</label>
                        <div class="two-col">
                            <input type="text" id="team2p1" placeholder="Name" style="border-color: white; margin-bottom: 10px;">
                            <input type="number" id="team2p1Hcp" placeholder="Hcp" min="0" max="54" style="border-color: white; margin-bottom: 10px;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label style="color: white; text-transform: none;">Player 2</label>
                        <div class="two-col">
                            <input type="text" id="team2p2" placeholder="Name" style="border-color: white;">
                            <input type="number" id="team2p2Hcp" placeholder="Hcp" min="0" max="54" style="border-color: white;">
                        </div>
                    </div>
                </div>

                <button class="btn" onclick="startTeam()">Start Match</button>
                <button class="btn btn-back" onclick="showScreen('scorecardUploadScreen')">Back</button>
            </div>
        </div>

        <!-- Skins Scorecard Screen -->
        <div id="skinsScorecardScreen" class="screen">
            <div class="card">
                <div class="scorecard-header">
                    <div class="hole-nav">
                        <button onclick="skinsPrevHole()" id="skinsPrevBtn">‚Üê Prev</button>
                    </div>
                    <div class="hole-info">
                        <h2 id="skinsHoleNumber">Hole 1</h2>
                        <p id="skinsHolePar">Par 4</p>
                        <p class="handicap" id="skinsHoleHcp">Handicap 1</p>
                    </div>
                    <div class="hole-nav">
                        <button onclick="skinsNextHole()" id="skinsNextBtn">Next ‚Üí</button>
                    </div>
                </div>

                <div class="score-inputs">
                    <div class="player-score">
                        <label id="skinsP1Label">Player 1</label>
                        <input type="number" id="skinsP1Score" min="1" max="15" onchange="handleSkinsScoreInput()">
                        <div class="score-display">
                            <span>Gross: <span id="skinsP1Gross">-</span></span>
                            <span>Net: <span id="skinsP1Net">-</span></span>
                        </div>
                    </div>
                    <div class="player-score">
                        <label id="skinsP2Label">Player 2</label>
                        <input type="number" id="skinsP2Score" min="1" max="15" onchange="handleSkinsScoreInput()">
                        <div class="score-display">
                            <span>Gross: <span id="skinsP2Gross">-</span></span>
                            <span>Net: <span id="skinsP2Net">-</span></span>
                        </div>
                    </div>
                    <div class="player-score">
                        <label id="skinsP3Label">Player 3</label>
                        <input type="number" id="skinsP3Score" min="1" max="15" onchange="handleSkinsScoreInput()">
                        <div class="score-display">
                            <span>Gross: <span id="skinsP3Gross">-</span></span>
                            <span>Net: <span id="skinsP3Net">-</span></span>
                        </div>
                    </div>
                </div>

                <div class="standings">
                    <h3>Skins Won</h3>
                    <div class="standing-item">
                        <span id="skinsName1">Player 1</span>
                        <span id="skinsCount1">0</span>
                    </div>
                    <div class="standing-item">
                        <span id="skinsName2">Player 2</span>
                        <span id="skinsCount2">0</span>
                    </div>
                    <div class="standing-item">
                        <span id="skinsName3">Player 3</span>
                        <span id="skinsCount3">0</span>
                    </div>
                    <div id="skinsCarryover" class="carryover" style="display: none;">
                        Carryover: 0 skins
                    </div>
                </div>

                <button class="btn" onclick="finishSkinsGame()" style="margin-top: 20px; display: none;" id="skinsFinishBtn">Complete Round</button>
            </div>
        </div>

        <!-- Team Scorecard Screen -->
        <div id="teamScorecardScreen" class="screen">
            <div class="card">
                <div class="scorecard-header">
                    <div class="hole-nav">
                        <button onclick="teamPrevHole()" id="teamPrevBtn">‚Üê Prev</button>
                    </div>
                    <div class="hole-info">
                        <h2 id="teamHoleNumber">Hole 1</h2>
                        <p id="teamHolePar">Par 4</p>
                        <p class="handicap" id="teamHoleHcp">Handicap 1</p>
                    </div>
                    <div class="hole-nav">
                        <button onclick="teamNextHole()" id="teamNextBtn">Next ‚Üí</button>
                    </div>
                </div>

                <div class="score-inputs">
                    <div class="player-score">
                        <label id="teamT1P1Label">Team 1 Player 1</label>
                        <input type="number" id="teamT1P1Score" min="1" max="15" onchange="handleTeamScoreInput()">
                        <div class="score-display">
                            <span>Gross: <span id="teamT1P1Gross">-</span></span>
                            <span>Net: <span id="teamT1P1Net">-</span></span>
                        </div>
                    </div>
                    <div class="player-score">
                        <label id="teamT1P2Label">Team 1 Player 2</label>
                        <input type="number" id="teamT1P2Score" min="1" max="15" onchange="handleTeamScoreInput()">
                        <div class="score-display">
                            <span>Gross: <span id="teamT1P2Gross">-</span></span>
                            <span>Net: <span id="teamT1P2Net">-</span></span>
                        </div>
                    </div>
                    <div class="player-score">
                        <label id="teamT2P1Label">Team 2 Player 1</label>
                        <input type="number" id="teamT2P1Score" min="1" max="15" onchange="handleTeamScoreInput()">
                        <div class="score-display">
                            <span>Gross: <span id="teamT2P1Gross">-</span></span>
                            <span>Net: <span id="teamT2P1Net">-</span></span>
                        </div>
                    </div>
                    <div class="player-score">
                        <label id="teamT2P2Label">Team 2 Player 2</label>
                        <input type="number" id="teamT2P2Score" min="1" max="15" onchange="handleTeamScoreInput()">
                        <div class="score-display">
                            <span>Gross: <span id="teamT2P2Gross">-</span></span>
                            <span>Net: <span id="teamT2P2Net">-</span></span>
                        </div>
                    </div>
                </div>

                <div class="standings">
                    <h3>Current Standings</h3>
                    <div class="standing-item">
                        <span>Skins</span>
                        <span id="teamSkinsStanding">Team 1: 0 | Team 2: 0</span>
                    </div>
                    <div class="standing-item">
                        <span>Nassau</span>
                        <span id="teamNassauStanding">Team 1: 0 | Team 2: 0</span>
                    </div>
                    <div class="standing-item">
                        <span>Scotch</span>
                        <span id="teamScotchStanding">Team 1: 0 | Team 2: 0</span>
                    </div>
                </div>

                <button class="btn" onclick="finishTeamMatch()" style="margin-top: 20px; display: none;" id="teamFinishBtn">Complete Round</button>
            </div>
        </div>

        <!-- Skins Results Screen -->
        <div id="skinsResultsScreen" class="screen">
            <div class="results-card">
                <h2>üèÜ Skins Results</h2>
                
                <div class="result-section">
                    <div id="skinsResultsList"></div>
                </div>
            </div>

            <div class="card">
                <button class="btn" onclick="resetApp()">New Game</button>
            </div>
        </div>

        <!-- Team Results Screen -->
        <div id="teamResultsScreen" class="screen">
            <div class="results-card">
                <h2>üèÜ Match Results</h2>
                
                <div class="result-section">
                    <h3>Skins</h3>
                    <div class="winner" id="teamSkinsWinner"></div>
                    <div class="money" id="teamSkinsMoney"></div>
                </div>

                <div class="result-section">
                    <h3>Nassau</h3>
                    <div class="winner" id="teamNassauWinner"></div>
                    <div class="money" id="teamNassauMoney"></div>
                </div>

                <div class="result-section">
                    <h3>Scotch (6-Point)</h3>
                    <div class="winner" id="teamScotchWinner"></div>
                    <div class="money" id="teamScotchMoney"></div>
                </div>

                <div class="result-section">
                    <h3>Total</h3>
                    <div class="winner" id="teamTotalWinner"></div>
                    <div class="money" id="teamTotalMoney"></div>
                </div>
            </div>

            <div class="card">
                <button class="btn" onclick="resetApp()">New Game</button>
            </div>
        </div>
    </div>

    <script>
        let pars = [4, 5, 3, 4, 4, 3, 5, 4, 4, 4, 3, 5, 4, 4, 3, 4, 5, 4];
        let handicapIndex = [1, 3, 15, 5, 11, 17, 7, 9, 13, 2, 16, 4, 6, 12, 18, 8, 10, 14];
        let currentMode = '';
        
        let skinsGame = {
            players: ['', '', ''],
            handicaps: [0, 0, 0],
            skinValue: 5,
            birdieMultiplier: false,
            currentHole: 0,
            scores: Array(18).fill(null).map(() => [null, null, null]),
            skins: [0, 0, 0],
            carryover: 0
        };

        let teamMatch = {
            team1: { player1: '', player2: '', hcp1: 0, hcp2: 0 },
            team2: { player1: '', player2: '', hcp1: 0, hcp2: 0 },
            pointValue: 5,
            birdieMultiplier: false,
            currentHole: 0,
            scores: Array(18).fill(null).map(() => ({
                team1p1: null, team1p2: null, team2p1: null, team2p2: null
            })),
            skins: { team1: 0, team2: 0, carryover: 0 },
            nassau: { front9: { team1: 0, team2: 0 }, back9: { team1: 0, team2: 0 }, overall: { team1: 0, team2: 0 } },
            scotch: { team1: 0, team2: 0 }
        };

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function selectMode(mode) {
            currentMode = mode;
            showScreen('scorecardUploadScreen');
        }

        function resetApp() {
            pars = [4, 5, 3, 4, 4, 3, 5, 4, 4, 4, 3, 5, 4, 4, 3, 4, 5, 4];
            handicapIndex = [1, 3, 15, 5, 11, 17, 7, 9, 13, 2, 16, 4, 6, 12, 18, 8, 10, 14];
            currentMode = '';
            skinsGame = {
                players: ['', '', ''],
                handicaps: [0, 0, 0],
                skinValue: 5,
                birdieMultiplier: false,
                currentHole: 0,
                scores: Array(18).fill(null).map(() => [null, null, null]),
                skins: [0, 0, 0],
                carryover: 0
            };
            teamMatch = {
                team1: { player1: '', player2: '', hcp1: 0, hcp2: 0 },
                team2: { player1: '', player2: '', hcp1: 0, hcp2: 0 },
                pointValue: 5,
                birdieMultiplier: false,
                currentHole: 0,
                scores: Array(18).fill(null).map(() => ({
                    team1p1: null, team1p2: null, team2p1: null, team2p2: null
                })),
                skins: { team1: 0, team2: 0, carryover: 0 },
                nassau: { front9: { team1: 0, team2: 0 }, back9: { team1: 0, team2: 0 }, overall: { team1: 0, team2: 0 } },
                scotch: { team1: 0, team2: 0 }
            };
            document.getElementById('scorecardPreview').style.display = 'none';
            showScreen('modeScreen');
        }

        // Drag and drop for scorecard upload
        const uploadArea = document.getElementById('uploadArea');
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleScorecardFile(files[0]);
            }
        });

        async function handleScorecardUpload(event) {
            const file = event.target.files[0];
            if (file) {
                handleScorecardFile(file);
            }
        }

        async function handleScorecardFile(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const preview = document.getElementById('scorecardPreview');
                preview.src = e.target.result;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(file);

            document.getElementById('loadingArea').style.display = 'block';

            try {
                const base64Data = await fileToBase64(file);
                const parsedData = await parseScorecardWithClaude(base64Data);
                
                if (parsedData && parsedData.pars && parsedData.handicapIndex) {
                    pars = parsedData.pars;
                    handicapIndex = parsedData.handicapIndex;
                    document.getElementById('loadingArea').style.display = 'none';
                    
                    if (currentMode === 'skins') {
                        showScreen('skinsSetupScreen');
                    } else {
                        showScreen('teamSetupScreen');
                    }
                } else {
                    throw new Error('Could not parse scorecard');
                }
            } catch (error) {
                console.error('Error parsing scorecard:', error);
                alert('Could not read scorecard. Please try again with a clearer photo.');
                document.getElementById('loadingArea').style.display = 'none';
            }
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        async function parseScorecardWithClaude(base64Image) {
            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 1000,
                        messages: [{
                            role: 'user',
                            content: [
                                {
                                    type: 'image',
                                    source: {
                                        type: 'base64',
                                        media_type: 'image/jpeg',
                                        data: base64Image
                                    }
                                },
                                {
                                    type: 'text',
                                    text: 'Extract the par values and handicap/stroke index for all 18 holes from this golf scorecard. Return ONLY a JSON object with this format: {"pars": [4,5,3,4,4,3,5,4,4,4,3,5,4,4,3,4,5,4], "handicapIndex": [1,3,15,5,11,17,7,9,13,2,16,4,6,12,18,8,10,14]}. Both arrays should have exactly 18 numbers representing holes 1-18 in order. The handicap index is also called stroke index or SI.'
                                }
                            ]
                        }]
                    })
                });

                const data = await response.json();
                const text = data.content.find(c => c.type === 'text')?.text;
                
                if (text) {
                    const cleaned = text.replace(/```json|```/g, '').trim();
                    return JSON.parse(cleaned);
                }
            } catch (error) {
                console.error('Claude API error:', error);
                throw error;
            }
        }

        function getStrokesForHole(holeIndex, playerHandicap) {
            const holeHcp = handicapIndex[holeIndex];
            if (playerHandicap >= holeHcp) {
                return Math.floor(playerHandicap / 18) + (playerHandicap % 18 >= holeHcp ? 1 : 0);
            }
            return 0;
        }

        // SKINS MODE
        function startSkins() {
            skinsGame.players[0] = document.getElementById('skinsPlayer1').value || 'Player 1';
            skinsGame.players[1] = document.getElementById('skinsPlayer2').value || 'Player 2';
            skinsGame.players[2] = document.getElementById('skinsPlayer3').value || 'Player 3';
            skinsGame.handicaps[0] = parseInt(document.getElementById('skinsHcp1').value) || 0;
            skinsGame.handicaps[1] = parseInt(document.getElementById('skinsHcp2').value) || 0;
            skinsGame.handicaps[2] = parseInt(document.getElementById('skinsHcp3').value) || 0;
            skinsGame.skinValue = parseInt(document.getElementById('skinValue').value);
            skinsGame.birdieMultiplier = document.getElementById('skinsBirdieMultiplier').checked;

            document.getElementById('skinsP1Label').textContent = skinsGame.players[0];
            document.getElementById('skinsP2Label').textContent = skinsGame.players[1];
            document.getElementById('skinsP3Label').textContent = skinsGame.players[2];

            document.getElementById('skinsName1').textContent = skinsGame.players[0];
            document.getElementById('skinsName2').textContent = skinsGame.players[1];
            document.getElementById('skinsName3').textContent = skinsGame.players[2];

            showScreen('skinsScorecardScreen');
            updateSkinsHole();
        }

        function updateSkinsHole() {
            const hole = skinsGame.currentHole;
            document.getElementById('skinsHoleNumber').textContent = `Hole ${hole + 1}`;
            document.getElementById('skinsHolePar').textContent = `Par ${pars[hole]}`;
            document.getElementById('skinsHoleHcp').textContent = `Handicap ${handicapIndex[hole]}`;

            document.getElementById('skinsP1Score').value = skinsGame.scores[hole][0] || '';
            document.getElementById('skinsP2Score').value = skinsGame.scores[hole][1] || '';
            document.getElementById('skinsP3Score').value = skinsGame.scores[hole][2] || '';

            updateSkinsScoreDisplay();

            document.getElementById('skinsPrevBtn').disabled = hole === 0;
            document.getElementById('skinsNextBtn').disabled = hole === 17;
            document.getElementById('skinsFinishBtn').style.display = hole === 17 ? 'block' : 'none';
        }

        function updateSkinsScoreDisplay() {
            const hole = skinsGame.currentHole;
            for (let i = 0; i < 3; i++) {
                const gross = skinsGame.scores[hole][i];
                if (gross) {
                    const strokes = getStrokesForHole(hole, skinsGame.handicaps[i]);
                    const net = gross - strokes;
                    document.getElementById(`skinsP${i+1}Gross`).textContent = gross;
                    document.getElementById(`skinsP${i+1}Net`).textContent = net;
                } else {
                    document.getElementById(`skinsP${i+1}Gross`).textContent = '-';
                    document.getElementById(`skinsP${i+1}Net`).textContent = '-';
                }
            }
        }

        function saveSkinsHole() {
            const hole = skinsGame.currentHole;
            skinsGame.scores[hole][0] = parseInt(document.getElementById('skinsP1Score').value) || null;
            skinsGame.scores[hole][1] = parseInt(document.getElementById('skinsP2Score').value) || null;
            skinsGame.scores[hole][2] = parseInt(document.getElementById('skinsP3Score').value) || null;
        }

        function handleSkinsScoreInput() {
            updateSkinsScoreDisplay();
            
            const scores = [
                parseInt(document.getElementById('skinsP1Score').value),
                parseInt(document.getElementById('skinsP2Score').value),
                parseInt(document.getElementById('skinsP3Score').value)
            ];

            if (scores.every(s => !isNaN(s) && s > 0)) {
                setTimeout(() => {
                    saveSkinsHole();
                    calculateSkinsStandings();
                    if (skinsGame.currentHole < 17) {
                        skinsGame.currentHole++;
                        updateSkinsHole();
                    } else {
                        document.getElementById('skinsFinishBtn').style.display = 'block';
                    }
                }, 300);
            }
        }

        function skinsPrevHole() {
            if (skinsGame.currentHole > 0) {
                saveSkinsHole();
                skinsGame.currentHole--;
                updateSkinsHole();
                calculateSkinsStandings();
            }
        }

        function skinsNextHole() {
            if (skinsGame.currentHole < 17) {
                saveSkinsHole();
                skinsGame.currentHole++;
                updateSkinsHole();
                calculateSkinsStandings();
            }
        }

        function calculateSkinsStandings() {
            saveSkinsHole();
            skinsGame.skins = [0, 0, 0];
            skinsGame.carryover = 0;

            for (let i = 0; i <= skinsGame.currentHole; i++) {
                const scores = skinsGame.scores[i];
                if (scores[0] === null || scores[1] === null || scores[2] === null) continue;

                const netScores = scores.map((gross, idx) => 
                    gross - getStrokesForHole(i, skinsGame.handicaps[idx])
                );
                const minScore = Math.min(...netScores);
                const winners = netScores.filter(s => s === minScore).length;

                if (winners === 1) {
                    const winnerIndex = netScores.indexOf(minScore);
                    let skinsWon = 1 + skinsGame.carryover;
                    
                    if (skinsGame.birdieMultiplier) {
                        const par = pars[i];
                        if (minScore === par - 1) {
                            skinsWon *= 2;
                        } else if (minScore <= par - 2) {
                            skinsWon *= 4;
                        }
                    }
                    
                    skinsGame.skins[winnerIndex] += skinsWon;
                    skinsGame.carryover = 0;
                } else {
                    skinsGame.carryover += 1;
                }
            }

            document.getElementById('skinsCount1').textContent = skinsGame.skins[0];
            document.getElementById('skinsCount2').textContent = skinsGame.skins[1];
            document.getElementById('skinsCount3').textContent = skinsGame.skins[2];

            const carryoverDiv = document.getElementById('skinsCarryover');
            if (skinsGame.carryover > 0) {
                carryoverDiv.style.display = 'block';
                carryoverDiv.textContent = `Carryover: ${skinsGame.carryover} skin${skinsGame.carryover > 1 ? 's' : ''}`;
            } else {
                carryoverDiv.style.display = 'none';
            }
        }

        function finishSkinsGame() {
            saveSkinsHole();
            calculateSkinsStandings();

            let html = '';
            const totalSkins = skinsGame.skins.reduce((a, b) => a + b, 0);
            const skinValue = skinsGame.skinValue;

            for (let i = 0; i < 3; i++) {
                const won = skinsGame.skins[i] * skinValue;
                const lost = (totalSkins - skinsGame.skins[i]) * skinValue / 2;
                const net = won - lost;
                
                html += `
                    <div style="padding: 15px; background: rgba(255,255,255,0.1); border-radius: 12px; margin-bottom: 10px;">
                        <div style="font-size: 1.3rem; font-weight: 700;">${skinsGame.players[i]}</div>
                        <div style="font-size: 1.1rem; margin: 8px 0;">${skinsGame.skins[i]} skins</div>
                        <div style="font-size: 1.5rem; color: var(--sand); font-weight: 900;">
                            ${net >= 0 ? '+' : ''}$${Math.round(net)}
                        </div>
                    </div>
                `;
            }

            document.getElementById('skinsResultsList').innerHTML = html;
            showScreen('skinsResultsScreen');
        }

        // TEAM MODE
        function startTeam() {
            teamMatch.team1.player1 = document.getElementById('team1p1').value || 'Team 1 Player 1';
            teamMatch.team1.player2 = document.getElementById('team1p2').value || 'Team 1 Player 2';
            teamMatch.team2.player1 = document.getElementById('team2p1').value || 'Team 2 Player 1';
            teamMatch.team2.player2 = document.getElementById('team2p2').value || 'Team 2 Player 2';
            teamMatch.team1.hcp1 = parseInt(document.getElementById('team1p1Hcp').value) || 0;
            teamMatch.team1.hcp2 = parseInt(document.getElementById('team1p2Hcp').value) || 0;
            teamMatch.team2.hcp1 = parseInt(document.getElementById('team2p1Hcp').value) || 0;
            teamMatch.team2.hcp2 = parseInt(document.getElementById('team2p2Hcp').value) || 0;
            teamMatch.pointValue = parseInt(document.getElementById('pointValue').value);
            teamMatch.birdieMultiplier = document.getElementById('teamBirdieMultiplier').checked;

            document.getElementById('teamT1P1Label').textContent = teamMatch.team1.player1;
            document.getElementById('teamT1P2Label').textContent = teamMatch.team1.player2;
            document.getElementById('teamT2P1Label').textContent = teamMatch.team2.player1;
            document.getElementById('teamT2P2Label').textContent = teamMatch.team2.player2;

            showScreen('teamScorecardScreen');
            updateTeamHole();
        }

        function updateTeamHole() {
            const hole = teamMatch.currentHole;
            document.getElementById('teamHoleNumber').textContent = `Hole ${hole + 1}`;
            document.getElementById('teamHolePar').textContent = `Par ${pars[hole]}`;
            document.getElementById('teamHoleHcp').textContent = `Handicap ${handicapIndex[hole]}`;

            const scores = teamMatch.scores[hole];
            document.getElementById('teamT1P1Score').value = scores.team1p1 || '';
            document.getElementById('teamT1P2Score').value = scores.team1p2 || '';
            document.getElementById('teamT2P1Score').value = scores.team2p1 || '';
            document.getElementById('teamT2P2Score').value = scores.team2p2 || '';

            updateTeamScoreDisplay();

            document.getElementById('teamPrevBtn').disabled = hole === 0;
            document.getElementById('teamNextBtn').disabled = hole === 17;
            document.getElementById('teamFinishBtn').style.display = hole === 17 ? 'block' : 'none';
        }

        function updateTeamScoreDisplay() {
            const hole = teamMatch.currentHole;
            const scores = teamMatch.scores[hole];
            
            const players = [
                { gross: scores.team1p1, hcp: teamMatch.team1.hcp1, id: 'teamT1P1' },
                { gross: scores.team1p2, hcp: teamMatch.team1.hcp2, id: 'teamT1P2' },
                { gross: scores.team2p1, hcp: teamMatch.team2.hcp1, id: 'teamT2P1' },
                { gross: scores.team2p2, hcp: teamMatch.team2.hcp2, id: 'teamT2P2' }
            ];

            players.forEach(p => {
                if (p.gross) {
                    const strokes = getStrokesForHole(hole, p.hcp);
                    const net = p.gross - strokes;
                    document.getElementById(`${p.id}Gross`).textContent = p.gross;
                    document.getElementById(`${p.id}Net`).textContent = net;
                } else {
                    document.getElementById(`${p.id}Gross`).textContent = '-';
                    document.getElementById(`${p.id}Net`).textContent = '-';
                }
            });
        }

        function saveTeamHole() {
            const hole = teamMatch.currentHole;
            teamMatch.scores[hole].team1p1 = parseInt(document.getElementById('teamT1P1Score').value) || null;
            teamMatch.scores[hole].team1p2 = parseInt(document.getElementById('teamT1P2Score').value) || null;
            teamMatch.scores[hole].team2p1 = parseInt(document.getElementById('teamT2P1Score').value) || null;
            teamMatch.scores[hole].team2p2 = parseInt(document.getElementById('teamT2P2Score').value) || null;
        }

        function handleTeamScoreInput() {
            updateTeamScoreDisplay();
            
            const scores = [
                parseInt(document.getElementById('teamT1P1Score').value),
                parseInt(document.getElementById('teamT1P2Score').value),
                parseInt(document.getElementById('teamT2P1Score').value),
                parseInt(document.getElementById('teamT2P2Score').value)
            ];

            if (scores.every(s => !isNaN(s) && s > 0)) {
                setTimeout(() => {
                    saveTeamHole();
                    calculateTeamStandings();
                    if (teamMatch.currentHole < 17) {
                        teamMatch.currentHole++;
                        updateTeamHole();
                    } else {
                        document.getElementById('teamFinishBtn').style.display = 'block';
                    }
                }, 300);
            }
        }

        function teamPrevHole() {
            if (teamMatch.currentHole > 0) {
                saveTeamHole();
                teamMatch.currentHole--;
                updateTeamHole();
                calculateTeamStandings();
            }
        }

        function teamNextHole() {
            if (teamMatch.currentHole < 17) {
                saveTeamHole();
                teamMatch.currentHole++;
                updateTeamHole();
                calculateTeamStandings();
            }
        }

        function calculateTeamStandings() {
            saveTeamHole();

            teamMatch.skins = { team1: 0, team2: 0, carryover: 0 };
            teamMatch.nassau = { front9: { team1: 0, team2: 0 }, back9: { team1: 0, team2: 0 }, overall: { team1: 0, team2: 0 } };
            teamMatch.scotch = { team1: 0, team2: 0 };

            for (let i = 0; i <= teamMatch.currentHole; i++) {
                const hole = teamMatch.scores[i];
                if (!hole.team1p1 || !hole.team1p2 || !hole.team2p1 || !hole.team2p2) continue;

                const t1p1Net = hole.team1p1 - getStrokesForHole(i, teamMatch.team1.hcp1);
                const t1p2Net = hole.team1p2 - getStrokesForHole(i, teamMatch.team1.hcp2);
                const t2p1Net = hole.team2p1 - getStrokesForHole(i, teamMatch.team2.hcp1);
                const t2p2Net = hole.team2p2 - getStrokesForHole(i, teamMatch.team2.hcp2);

                const team1Best = Math.min(t1p1Net, t1p2Net);
                const team2Best = Math.min(t2p1Net, t2p2Net);
                const team1Total = t1p1Net + t1p2Net;
                const team2Total = t2p1Net + t2p2Net;

                // Skins
                if (team1Best < team2Best) {
                    let skinsWon = 1 + teamMatch.skins.carryover;
                    if (teamMatch.birdieMultiplier) {
                        const par = pars[i];
                        if (team1Best === par - 1) skinsWon *= 2;
                        else if (team1Best <= par - 2) skinsWon *= 4;
                    }
                    teamMatch.skins.team1 += skinsWon;
                    teamMatch.skins.carryover = 0;
                } else if (team2Best < team1Best) {
                    let skinsWon = 1 + teamMatch.skins.carryover;
                    if (teamMatch.birdieMultiplier) {
                        const par = pars[i];
                        if (team2Best === par - 1) skinsWon *= 2;
                        else if (team2Best <= par - 2) skinsWon *= 4;
                    }
                    teamMatch.skins.team2 += skinsWon;
                    teamMatch.skins.carryover = 0;
                } else {
                    teamMatch.skins.carryover += 1;
                }

                // Nassau
                if (team1Best < team2Best) {
                    if (i < 9) teamMatch.nassau.front9.team1++;
                    else teamMatch.nassau.back9.team1++;
                    teamMatch.nassau.overall.team1++;
                } else if (team2Best < team1Best) {
                    if (i < 9) teamMatch.nassau.front9.team2++;
                    else teamMatch.nassau.back9.team2++;
                    teamMatch.nassau.overall.team2++;
                }

                // Scotch (using net scores)
                let scotchPts = 0;
                if (Math.min(t1p1Net, t1p2Net) < Math.min(t2p1Net, t2p2Net)) scotchPts += 2;
                else if (Math.min(t2p1Net, t2p2Net) < Math.min(t1p1Net, t1p2Net)) scotchPts -= 2;
                
                if (team1Total < team2Total) scotchPts += 2;
                else if (team2Total < team1Total) scotchPts -= 2;
                
                const birdie1 = t1p1Net < pars[i] || t1p2Net < pars[i];
                const birdie2 = t2p1Net < pars[i] || t2p2Net < pars[i];
                if (birdie1 && !birdie2) scotchPts += 1;
                else if (birdie2 && !birdie1) scotchPts -= 1;
                
                if (Math.abs(scotchPts) === 6) scotchPts *= 2;
                
                if (scotchPts > 0) teamMatch.scotch.team1 += scotchPts;
                else teamMatch.scotch.team2 += Math.abs(scotchPts);
            }

            document.getElementById('teamSkinsStanding').textContent = 
                `Team 1: ${teamMatch.skins.team1} | Team 2: ${teamMatch.skins.team2}`;
            
            const nassauT1 = (teamMatch.nassau.front9.team1 > teamMatch.nassau.front9.team2 ? 1 : 0) +
                            (teamMatch.nassau.back9.team1 > teamMatch.nassau.back9.team2 ? 1 : 0) +
                            (teamMatch.nassau.overall.team1 > teamMatch.nassau.overall.team2 ? 1 : 0);
            const nassauT2 = (teamMatch.nassau.front9.team2 > teamMatch.nassau.front9.team1 ? 1 : 0) +
                            (teamMatch.nassau.back9.team2 > teamMatch.nassau.back9.team1 ? 1 : 0) +
                            (teamMatch.nassau.overall.team2 > teamMatch.nassau.overall.team1 ? 1 : 0);
            
            document.getElementById('teamNassauStanding').textContent = `Team 1: ${nassauT1} | Team 2: ${nassauT2}`;
            document.getElementById('teamScotchStanding').textContent = 
                `Team 1: ${teamMatch.scotch.team1} | Team 2: ${teamMatch.scotch.team2}`;
        }

        function finishTeamMatch() {
            saveTeamHole();
            calculateTeamStandings();

            const pv = teamMatch.pointValue;

            const skinsWon = teamMatch.skins.team1 - teamMatch.skins.team2;
            document.getElementById('teamSkinsWinner').textContent = 
                skinsWon > 0 ? 'Team 1 Wins!' : skinsWon < 0 ? 'Team 2 Wins!' : 'Tie';
            document.getElementById('teamSkinsMoney').textContent = `$${Math.abs(skinsWon) * pv}`;

            const nassauT1 = (teamMatch.nassau.front9.team1 > teamMatch.nassau.front9.team2 ? 1 : 0) +
                            (teamMatch.nassau.back9.team1 > teamMatch.nassau.back9.team2 ? 1 : 0) +
                            (teamMatch.nassau.overall.team1 > teamMatch.nassau.overall.team2 ? 1 : 0);
            const nassauT2 = (teamMatch.nassau.front9.team2 > teamMatch.nassau.front9.team1 ? 1 : 0) +
                            (teamMatch.nassau.back9.team2 > teamMatch.nassau.back9.team1 ? 1 : 0) +
                            (teamMatch.nassau.overall.team2 > teamMatch.nassau.overall.team1 ? 1 : 0);
            const nassauWon = nassauT1 - nassauT2;
            document.getElementById('teamNassauWinner').textContent = 
                nassauWon > 0 ? 'Team 1 Wins!' : nassauWon < 0 ? 'Team 2 Wins!' : 'Tie';
            document.getElementById('teamNassauMoney').textContent = `$${Math.abs(nassauWon) * pv}`;

            const scotchWon = teamMatch.scotch.team1 - teamMatch.scotch.team2;
            document.getElementById('teamScotchWinner').textContent = 
                scotchWon > 0 ? 'Team 1 Wins!' : scotchWon < 0 ? 'Team 2 Wins!' : 'Tie';
            document.getElementById('teamScotchMoney').textContent = `$${Math.abs(scotchWon) * pv}`;

            const total = (Math.abs(skinsWon) + Math.abs(nassauWon) + Math.abs(scotchWon)) * pv;
            const totalWinner = (skinsWon + nassauWon + scotchWon) > 0 ? 'Team 1' : 
                               (skinsWon + nassauWon + scotchWon) < 0 ? 'Team 2' : 'Tie';
            document.getElementById('teamTotalWinner').textContent = totalWinner;
            document.getElementById('teamTotalMoney').textContent = `$${total}`;

            showScreen('teamResultsScreen');
        }
    </script>
</body>
</html>
